---
title: "Health Check"
api: "GET /actuator/health"
description: "Verifica o status de saúde da API e seus componentes"
---

<Note>
O endpoint de health check fornece informações sobre o status de todos os componentes da aplicação, incluindo banco de dados, Redis, Evolution API e outros serviços.
</Note>

## Visão Geral

Este endpoint é fornecido pelo Spring Boot Actuator e permite monitorar a saúde da aplicação. Útil para:

- **Monitoramento** - Sistemas de monitoramento podem verificar se a API está funcionando
- **Load Balancers** - Verificar se a instância está saudável
- **Containers** - Health checks do Docker/Kubernetes
- **Debugging** - Identificar componentes com problemas

## Endpoint Público

Este endpoint não requer autenticação e está disponível publicamente.

<RequestExample>

```bash cURL
curl -X GET https://api.disparador.com/actuator/health
```

```javascript JavaScript
const response = await fetch('https://api.disparador.com/actuator/health');
const health = await response.json();

if (health.status === 'UP') {
  console.log('✅ API funcionando normalmente');
} else {
  console.error('❌ API com problemas:', health.status);
}

// Verificar componentes específicos
if (health.components) {
  Object.entries(health.components).forEach(([name, component]) => {
    console.log(`${name}: ${component.status}`);
  });
}
```

```python Python
import requests

response = requests.get('https://api.disparador.com/actuator/health')
health = response.json()

print(f"Status geral: {health['status']}")

# Verificar cada componente
if 'components' in health:
    for name, component in health['components'].items():
        status = component['status']
        emoji = '✅' if status == 'UP' else '❌'
        print(f"{emoji} {name}: {status}")
```

```php PHP
<?php
$url = 'https://api.disparador.com/actuator/health';
$result = file_get_contents($url);
$health = json_decode($result, true);

echo "Status geral: " . $health['status'] . "\n";

// Verificar componentes
if (isset($health['components'])) {
    foreach ($health['components'] as $name => $component) {
        $status = $component['status'];
        $emoji = $status === 'UP' ? '✅' : '❌';
        echo "{$emoji} {$name}: {$status}\n";
    }
}
?>
```

</RequestExample>

## Response

<ResponseField name="status" type="string">
  Status geral da aplicação
  - `UP` - Todos os componentes funcionando
  - `DOWN` - Um ou mais componentes com problemas
  - `OUT_OF_SERVICE` - Aplicação fora de serviço
  - `UNKNOWN` - Status não determinado
</ResponseField>

<ResponseField name="components" type="object">
  Status individual de cada componente
  
  <Expandable title="Componentes monitorados">
    <ResponseField name="db" type="object">
      Status do banco de dados PostgreSQL
    </ResponseField>
    
    <ResponseField name="redis" type="object">
      Status do cache Redis (implementação customizada)
    </ResponseField>
    
    <ResponseField name="evolutionApi" type="object">
      Status da conexão com Evolution API
      
      <Expandable title="Detalhes Evolution API">
        - `activeConfigurations` - Número de configurações ativas
        - `status` - connected/disconnected/no active configurations
        - `testedInstance` - Nome da instância testada
        - `connectionError` - Erro de conexão (se houver)
      </Expandable>
    </ResponseField>
    
    <ResponseField name="diskSpace" type="object">
      Status do espaço em disco
    </ResponseField>
    
    <ResponseField name="ping" type="object">
      Status básico da aplicação
    </ResponseField>
  </Expandable>
</ResponseField>

<ResponseExample>

```json 200 - Sistema Saudável
{
  "status": "UP",
  "components": {
    "db": {
      "status": "UP",
      "details": {
        "database": "PostgreSQL",
        "validationQuery": "SELECT 1"
      }
    },
    "redis": {
      "status": "UP",
      "details": {
        "response": "PONG"
      }
    },
    "evolutionApi": {
      "status": "UP",
      "details": {
        "service": "Evolution API",
        "activeConfigurations": 2,
        "status": "connected",
        "testedInstance": "WhatsApp Principal"
      }
    },
    "diskSpace": {
      "status": "UP",
      "details": {
        "total": 107374182400,
        "free": 53687091200,
        "threshold": 10485760,
        "path": "/",
        "exists": true
      }
    },
    "ping": {
      "status": "UP"
    }
  }
}
```

```json 503 - Sistema com Problemas
{
  "status": "DOWN",
  "components": {
    "db": {
      "status": "UP",
      "details": {
        "database": "PostgreSQL",
        "validationQuery": "SELECT 1"
      }
    },
    "redis": {
      "status": "DOWN",
      "details": {
        "error": "Unable to connect to Redis"
      }
    },
    "evolutionApi": {
      "status": "DOWN",
      "details": {
        "service": "Evolution API",
        "activeConfigurations": 1,
        "status": "disconnected",
        "testedInstance": "WhatsApp Principal",
        "error": "Failed to connect to Evolution API"
      }
    },
    "diskSpace": {
      "status": "UP",
      "details": {
        "total": 107374182400,
        "free": 5368709120,
        "threshold": 10485760,
        "path": "/",
        "exists": true
      }
    },
    "ping": {
      "status": "UP"
    }
  }
}
```

</ResponseExample>

## Detalhes dos Componentes

### Database (db)
- Verifica conexão com PostgreSQL
- Executa query de validação
- Retorna `DOWN` se não conseguir conectar

### Redis
- Implementação customizada que executa comando PING
- Verifica se a resposta é "PONG"
- Retorna `DOWN` se Redis estiver inacessível

### Evolution API
- Verifica conexão com as instâncias configuradas
- Testa a primeira configuração ativa encontrada
- Retorna `UP` mesmo sem configurações ativas
- Inclui detalhes sobre configurações e status de conexão

### Disk Space
- Verifica espaço disponível em disco
- `threshold`: Espaço mínimo necessário (10MB)
- Retorna `DOWN` se espaço livre < threshold

### Ping
- Verificação básica se a aplicação está respondendo
- Sempre retorna `UP` se a aplicação estiver rodando

## Códigos HTTP

| Código | Status | Descrição |
|--------|--------|-----------|
| 200 | UP | Todos os componentes funcionando |
| 503 | DOWN | Um ou mais componentes com problemas |
| 503 | OUT_OF_SERVICE | Aplicação em manutenção |

## Monitoramento Automatizado

```javascript
// Script de monitoramento com verificação de Evolution API
async function monitorHealth() {
  const healthUrl = 'https://api.disparador.com/actuator/health';
  const alertWebhook = 'https://seu-webhook.com/alerts';
  
  try {
    const response = await fetch(healthUrl);
    const health = await response.json();
    
    if (health.status !== 'UP') {
      // Identificar componentes com problema
      const problemComponents = Object.entries(health.components)
        .filter(([_, component]) => component.status !== 'UP')
        .map(([name, component]) => ({
          name,
          status: component.status,
          error: component.details?.error
        }));
      
      // Enviar alerta detalhado
      await fetch(alertWebhook, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          service: 'API Disparador',
          status: health.status,
          problemComponents,
          timestamp: new Date().toISOString()
        })
      });
      
      console.error('⚠️ API com problemas:', problemComponents);
    }
  } catch (error) {
    console.error('❌ API inacessível:', error);
  }
}

// Verificar a cada minuto
setInterval(monitorHealth, 60000);
```

## Integração com Docker

```dockerfile
# docker-compose.yml
services:
  api:
    image: disparador-api:latest
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/actuator/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
```

## Integração com Kubernetes

```yaml
# deployment.yaml
apiVersion: apps/v1
kind: Deployment
spec:
  template:
    spec:
      containers:
      - name: api
        livenessProbe:
          httpGet:
            path: /actuator/health
            port: 80
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /actuator/health
            port: 80
          initialDelaySeconds: 5
          periodSeconds: 5
```

## Verificação de Componentes Específicos

```javascript
// Verificar apenas Evolution API
async function checkEvolutionApi() {
  const response = await fetch('https://api.disparador.com/actuator/health');
  const health = await response.json();
  
  const evolutionStatus = health.components?.evolutionApi;
  
  if (evolutionStatus?.status === 'DOWN') {
    console.error('Evolution API com problemas:', evolutionStatus.details);
    
    // Verificar se é problema de configuração
    if (evolutionStatus.details?.activeConfigurations === 0) {
      console.log('Nenhuma configuração Evolution ativa');
    }
  }
}
```

## Boas Práticas

<CardGroup cols={2}>
  <Card title="Frequência" icon="clock" color="#3b82f6">
    Não verificar mais de 1x por minuto em produção
  </Card>
  <Card title="Timeouts" icon="hourglass" color="#ef4444">
    Configure timeout de 10 segundos para evitar travamentos
  </Card>
  <Card title="Alertas" icon="bell" color="#f59e0b">
    Configure alertas apenas para falhas consecutivas
  </Card>
  <Card title="Logs" icon="file-text" color="#8b5cf6">
    Registre mudanças de status para análise
  </Card>
</CardGroup> 