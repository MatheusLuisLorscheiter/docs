---
title: "Criar Automa√ß√£o"
api: "POST /api/automations"
description: "Cria uma automa√ß√£o por segmenta√ß√£o com filtros e configura√ß√£o de mensagem"
---

<Tip>
Use automa√ß√µes para disparos recorrentes baseados em filtros din√¢micos. S√£o independentes de campanhas e executam automaticamente com base no agendamento configurado.
</Tip>

## Headers

<ParamField header="Content-Type" type="string" required>
  application/json
</ParamField>

<ParamField header="X-Access-Token" type="string" required>
  Token de acesso da empresa
</ParamField>

## Body

### Campos principais

<ParamField body="name" type="string" required>
  Nome da automa√ß√£o
</ParamField>

<ParamField body="description" type="string" optional>
  Descri√ß√£o da automa√ß√£o
</ParamField>

<ParamField body="isActive" type="boolean" default="true">
  Define se a automa√ß√£o inicia ativa
</ParamField>

### Agendamento

<ParamField body="scheduleType" type="string" required>
  Tipo de agendamento
  
  Valores aceitos:
  - `DAILY` - Execu√ß√£o di√°ria
  - `WEEKLY` - Execu√ß√£o semanal
  - `MONTHLY` - Execu√ß√£o mensal
  - `CRON` - Express√£o cron customizada
</ParamField>

<ParamField body="schedule" type="object" required>
  Configura√ß√£o do agendamento
  
  <Expandable title="Campos do schedule">
    <ParamField body="timeOfDay" type="string">
      Hor√°rio de execu√ß√£o (formato HH:mm)
    </ParamField>
    
    <ParamField body="timezone" type="string">
      Fuso hor√°rio (ex: America/Sao_Paulo)
    </ParamField>
    
    <ParamField body="weekdays" type="array">
      Dias da semana para execu√ß√£o (1=Dom, 2=Seg, ..., 7=S√°b)
      Usado com DAILY ou WEEKLY
    </ParamField>
    
    <ParamField body="dayOfMonth" type="number">
      Dia do m√™s para execu√ß√£o (1-31)
      Usado com MONTHLY
    </ParamField>
    
    <ParamField body="cronExpression" type="string">
      Express√£o cron customizada
      Usado com CRON
    </ParamField>
  </Expandable>
</ParamField>

### Segmenta√ß√£o

<ParamField body="databaseConfigId" type="number" required>
  ID da configura√ß√£o de banco de dados externo
</ParamField>

<ParamField body="filters" type="array" optional>
  Filtros din√¢micos para segmenta√ß√£o
  
  <Expandable title="Estrutura do filtro">
    <ParamField body="filterId" type="string">
      ID do filtro (ex: birthday, segment, city)
    </ParamField>
    
    <ParamField body="value" type="any">
      Valor do filtro
    </ParamField>
    
    <ParamField body="operator" type="string">
      Operador de compara√ß√£o (equals, contains, etc)
    </ParamField>
    
    <ParamField body="ignoreYear" type="boolean">
      Para filtros de data, ignora o ano (√∫til para anivers√°rios)
    </ParamField>
  </Expandable>
</ParamField>

### Configura√ß√£o da Mensagem

<ParamField body="messageConfig" type="object" required>
  Configura√ß√£o da mensagem a ser enviada
  
  <Expandable title="Campos do messageConfig">
    <ParamField body="message" type="string">
      Texto da mensagem (suporta vari√°veis como {PrimeiroNome})
    </ParamField>
    
    <ParamField body="mediaUrl" type="string">
      URL da m√≠dia anexada
    </ParamField>
    
    <ParamField body="mediaType" type="string">
      Tipo de m√≠dia (image, video, audio, document)
    </ParamField>
    
    <ParamField body="fileName" type="string">
      Nome do arquivo (para documentos)
    </ParamField>
    
    <ParamField body="caption" type="string">
      Legenda da m√≠dia
    </ParamField>
    
    <ParamField body="pollData" type="object">
      Dados da enquete
      
      <Expandable title="Campos do pollData">
        <ParamField body="name" type="string">
          Pergunta da enquete
        </ParamField>
        
        <ParamField body="selectableCount" type="number">
          Quantidade de op√ß√µes selecion√°veis
        </ParamField>
        
        <ParamField body="options" type="array">
          Array de strings com as op√ß√µes
        </ParamField>
      </Expandable>
    </ParamField>
  </Expandable>
</ParamField>

<ParamField body="evolutionConfigId" type="number" required>
  ID da configura√ß√£o da Evolution API
</ParamField>

### Comportamento de Envio

<ParamField body="intervalMinSeconds" type="number" default="5">
  Intervalo m√≠nimo entre mensagens em segundos
</ParamField>

<ParamField body="intervalMaxSeconds" type="number" default="12">
  Intervalo m√°ximo entre mensagens em segundos
</ParamField>

<ParamField body="notificationPhone" type="string" optional>
  Telefone para notifica√ß√£o ao t√©rmino
</ParamField>

<ParamField body="dedupStrategy" type="string" default="ONCE">
  Estrat√©gia de deduplica√ß√£o
  
  Valores aceitos:
  - `NEVER` - Nunca deduplica (permite reenvios)
  - `ONCE` - Deduplica sempre (evita qualquer reenvio)
  - `COOLDOWN_DAYS` - Deduplica por per√≠odo (requer dedupCooldownDays)
</ParamField>

<ParamField body="dedupCooldownDays" type="number" optional>
  Dias de cooldown para deduplica√ß√£o (quando dedupStrategy = COOLDOWN_DAYS)
</ParamField>

<ParamField body="sendLimitPerRun" type="number" optional>
  Limite de envios por execu√ß√£o (√∫til para controlar volume)
</ParamField>

<RequestExample>

```bash cURL
curl -X POST https://api.disparador.com/api/automations \
  -H "Content-Type: application/json" \
  -H "X-Access-Token: seu-access-token" \
  -d '{
    "name": "Aniversariantes do Dia",
    "description": "Envia mensagem de parab√©ns para aniversariantes",
    "isActive": true,
    "scheduleType": "DAILY",
    "schedule": {
      "timeOfDay": "09:00",
      "timezone": "America/Sao_Paulo",
      "weekdays": [2, 3, 4, 5, 6]
    },
    "databaseConfigId": 1,
    "filters": [
      {
        "filterId": "birthday",
        "value": "2025-08-13",
        "operator": "equals",
        "ignoreYear": true
      }
    ],
    "messageConfig": {
      "message": "üéâ Parab√©ns {PrimeiroNome}! üéÇ\n\nDesejamos um dia muito especial!"
    },
    "evolutionConfigId": 2,
    "intervalMinSeconds": 5,
    "intervalMaxSeconds": 12,
    "dedupStrategy": "ONCE",
    "sendLimitPerRun": 100
  }'
```

```javascript JavaScript
const automation = {
  name: "Promo√ß√£o Semanal",
  description: "Envia promo√ß√£o toda segunda-feira",
  isActive: true,
  scheduleType: "WEEKLY",
  schedule: {
    timeOfDay: "10:00",
    timezone: "America/Sao_Paulo",
    weekdays: [2] // Segunda-feira
  },
  databaseConfigId: 1,
  filters: [
    {
      filterId: "segment",
      value: "VIP",
      operator: "equals"
    }
  ],
  messageConfig: {
    message: "Ol√° {PrimeiroNome}! Confira as ofertas especiais da semana!",
    mediaUrl: "https://exemplo.com/promo.jpg",
    mediaType: "image"
  },
  evolutionConfigId: 1,
  intervalMinSeconds: 10,
  intervalMaxSeconds: 20,
  dedupStrategy: "COOLDOWN_DAYS",
  dedupCooldownDays: 7
};

const response = await fetch('https://api.disparador.com/api/automations', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'X-Access-Token': 'seu-access-token'
  },
  body: JSON.stringify(automation)
});
```

```python Python
import requests

automation = {
    "name": "Lembrete Mensal",
    "isActive": True,
    "scheduleType": "MONTHLY",
    "schedule": {
        "timeOfDay": "14:00",
        "timezone": "America/Sao_Paulo",
        "dayOfMonth": 15
    },
    "databaseConfigId": 1,
    "filters": [
        {
            "filterId": "payment_status",
            "value": "pending",
            "operator": "equals"
        }
    ],
    "messageConfig": {
        "message": "Ol√° {PrimeiroNome}, seu pagamento est√° pendente."
    },
    "evolutionConfigId": 1,
    "intervalMinSeconds": 5,
    "intervalMaxSeconds": 10,
    "dedupStrategy": "ONCE"
}

response = requests.post(
    'https://api.disparador.com/api/automations',
    json=automation,
    headers={
        'X-Access-Token': 'seu-access-token'
    }
)
```

</RequestExample>

## Response

<ResponseField name="id" type="number">
  ID da automa√ß√£o criada
</ResponseField>

<ResponseField name="name" type="string">
  Nome da automa√ß√£o
</ResponseField>

<ResponseField name="description" type="string">
  Descri√ß√£o da automa√ß√£o
</ResponseField>

<ResponseField name="isActive" type="boolean">
  Se est√° ativa
</ResponseField>

<ResponseField name="scheduleType" type="string">
  Tipo de agendamento
</ResponseField>

<ResponseField name="schedule" type="object">
  Configura√ß√£o completa do agendamento
</ResponseField>

<ResponseField name="databaseConfigId" type="number">
  ID da configura√ß√£o de banco
</ResponseField>

<ResponseField name="evolutionConfigId" type="number">
  ID da configura√ß√£o Evolution
</ResponseField>

<ResponseField name="intervalMinSeconds" type="number">
  Intervalo m√≠nimo configurado
</ResponseField>

<ResponseField name="intervalMaxSeconds" type="number">
  Intervalo m√°ximo configurado
</ResponseField>

<ResponseField name="notificationPhone" type="string">
  Telefone de notifica√ß√£o
</ResponseField>

<ResponseField name="dedupStrategy" type="string">
  Estrat√©gia de deduplica√ß√£o
</ResponseField>

<ResponseField name="dedupCooldownDays" type="number">
  Dias de cooldown
</ResponseField>

<ResponseField name="sendLimitPerRun" type="number">
  Limite por execu√ß√£o
</ResponseField>

<ResponseField name="lastRunAt" type="string">
  Data/hora da √∫ltima execu√ß√£o
</ResponseField>

<ResponseField name="nextRunAt" type="string">
  Pr√≥xima execu√ß√£o prevista
</ResponseField>

<ResponseField name="createdAt" type="string">
  Data/hora de cria√ß√£o
</ResponseField>

<ResponseField name="updatedAt" type="string">
  Data/hora da √∫ltima atualiza√ß√£o
</ResponseField>

<ResponseExample>

```json 200 - Sucesso
{
  "id": 10,
  "name": "Aniversariantes do Dia",
  "description": "Envia mensagem de parab√©ns para aniversariantes",
  "isActive": true,
  "scheduleType": "DAILY",
  "schedule": {
    "timeOfDay": "09:00",
    "timezone": "America/Sao_Paulo",
    "weekdays": [2, 3, 4, 5, 6]
  },
  "databaseConfigId": 1,
  "evolutionConfigId": 2,
  "intervalMinSeconds": 5,
  "intervalMaxSeconds": 12,
  "notificationPhone": null,
  "dedupStrategy": "ONCE",
  "dedupCooldownDays": null,
  "sendLimitPerRun": 100,
  "lastRunAt": null,
  "nextRunAt": "2024-01-22T09:00:00",
  "createdAt": "2024-01-21T15:30:00",
  "updatedAt": "2024-01-21T15:30:00"
}
```

```json 400 - Erro de Valida√ß√£o
{
  "message": "Nome √© obrigat√≥rio"
}
```

```json 401 - Token Inv√°lido
{
  "message": "Access token inv√°lido"
}
```

</ResponseExample>

## Exemplos de Automa√ß√µes

### Aniversariantes
```json
{
  "name": "Parab√©ns Aniversariantes",
  "scheduleType": "DAILY",
  "schedule": {
    "timeOfDay": "09:00",
    "timezone": "America/Sao_Paulo"
  },
  "filters": [
    {
      "filterId": "birthday",
      "ignoreYear": true
    }
  ],
  "messageConfig": {
    "message": "Parab√©ns {PrimeiroNome}! üéâ"
  },
  "dedupStrategy": "ONCE"
}
```

### Lembrete de Pagamento
```json
{
  "name": "Cobran√ßa Semanal",
  "scheduleType": "WEEKLY",
  "schedule": {
    "timeOfDay": "10:00",
    "weekdays": [2]
  },
  "filters": [
    {
      "filterId": "payment_status",
      "value": "overdue",
      "operator": "equals"
    }
  ],
  "messageConfig": {
    "message": "Ol√° {PrimeiroNome}, seu pagamento est√° em atraso."
  },
  "dedupStrategy": "COOLDOWN_DAYS",
  "dedupCooldownDays": 7
}
```

### Enquete Mensal
```json
{
  "name": "Pesquisa de Satisfa√ß√£o",
  "scheduleType": "MONTHLY",
  "schedule": {
    "dayOfMonth": 1,
    "timeOfDay": "14:00"
  },
  "messageConfig": {
    "pollData": {
      "name": "Como voc√™ avalia nosso servi√ßo?",
      "selectableCount": 1,
      "options": ["Excelente", "Bom", "Regular", "Ruim"]
    }
  },
  "dedupStrategy": "COOLDOWN_DAYS",
  "dedupCooldownDays": 30
}
```


