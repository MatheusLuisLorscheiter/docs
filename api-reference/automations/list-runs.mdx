---
title: "Listar Execu√ß√µes (Runs)"
api: "GET /api/automations/{automationId}/runs"
description: "Lista o hist√≥rico de execu√ß√µes de uma automa√ß√£o"
---

<Tip>
Use este endpoint para monitorar o hist√≥rico e performance das execu√ß√µes da automa√ß√£o.
</Tip>

## Path Parameters

<ParamField path="automationId" type="number" required>
  ID da automa√ß√£o
</ParamField>

## Headers

<ParamField header="X-Access-Token" type="string" required>
  Token de acesso da empresa
</ParamField>

<RequestExample>

```bash cURL
curl -X GET https://api.disparador.com/api/automations/10/runs \
  -H "X-Access-Token: seu-access-token"
```

```javascript JavaScript
async function getAutomationRuns(automationId, accessToken) {
  const response = await fetch(
    `https://api.disparador.com/api/automations/${automationId}/runs`,
    {
      headers: {
        'X-Access-Token': accessToken
      }
    }
  );
  
  const runs = await response.json();
  
  console.log(`Total de execu√ß√µes: ${runs.length}`);
  
  // Analisar execu√ß√µes recentes
  runs.slice(0, 5).forEach(run => {
    console.log(`Run #${run.id}:`);
    console.log(`  Status: ${run.status}`);
    console.log(`  Enviados: ${run.sentCount}/${run.matchedContacts}`);
    console.log(`  Iniciado: ${run.startedAt}`);
  });
  
  return runs;
}

// Listar runs
const runs = await getAutomationRuns(10, 'seu-access-token');
```

```python Python
import requests
from datetime import datetime

def get_automation_runs(automation_id, access_token):
    url = f"https://api.disparador.com/api/automations/{automation_id}/runs"
    headers = {"X-Access-Token": access_token}
    
    response = requests.get(url, headers=headers)
    
    if response.status_code == 200:
        runs = response.json()
        print(f"Total de execu√ß√µes: {len(runs)}")
        
        for run in runs[:5]:  # √öltimas 5
            print(f"\nRun #{run['id']}:")
            print(f"  Status: {run['status']}")
            print(f"  Contatos: {run['matchedContacts']}")
            print(f"  Enviados: {run['sentCount']}")
            print(f"  Falhas: {run['failedCount']}")
            
        return runs
    else:
        print(f"Erro: {response.status_code}")
        return []

# Listar
runs = get_automation_runs(10, "seu-access-token")
```

```php PHP
<?php
function getAutomationRuns($automationId, $accessToken) {
    $url = "https://api.disparador.com/api/automations/{$automationId}/runs";
    
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL, $url);
    curl_setopt($ch, CURLOPT_HTTPHEADER, [
        'X-Access-Token: ' . $accessToken
    ]);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    
    $response = curl_exec($ch);
    $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);
    curl_close($ch);
    
    if ($httpCode === 200) {
        $runs = json_decode($response, true);
        echo "Total de execu√ß√µes: " . count($runs) . "\n\n";
        
        // Mostrar √∫ltimas 5
        foreach (array_slice($runs, 0, 5) as $run) {
            echo "Run #{$run['id']}:\n";
            echo "  Status: {$run['status']}\n";
            echo "  Enviados: {$run['sentCount']}/{$run['matchedContacts']}\n";
            echo "  Iniciado: {$run['startedAt']}\n\n";
        }
        
        return $runs;
    }
    
    return [];
}

// Listar
$runs = getAutomationRuns(10, 'seu-access-token');
?>
```

</RequestExample>

## Response

Array de objetos de execu√ß√£o (runs), ordenados por ID descendente (mais recentes primeiro):

<ResponseField name="id" type="number">
  ID √∫nico da execu√ß√£o
</ResponseField>

<ResponseField name="status" type="string">
  Status da execu√ß√£o
  
  Valores poss√≠veis:
  - `PENDING` - Aguardando in√≠cio
  - `RUNNING` - Em execu√ß√£o
  - `COMPLETED` - Conclu√≠da com sucesso
  - `FAILED` - Falhou
  - `CANCELLED` - Cancelada
</ResponseField>

<ResponseField name="scheduledFor" type="string">
  Data/hora agendada para execu√ß√£o
</ResponseField>

<ResponseField name="startedAt" type="string">
  Data/hora de in√≠cio real
</ResponseField>

<ResponseField name="finishedAt" type="string">
  Data/hora de t√©rmino
</ResponseField>

<ResponseField name="matchedContacts" type="number">
  Total de contatos que passaram pelos filtros
</ResponseField>

<ResponseField name="sentCount" type="number">
  Quantidade de mensagens enviadas com sucesso
</ResponseField>

<ResponseField name="failedCount" type="number">
  Quantidade de falhas no envio
</ResponseField>

<ResponseField name="errorMessage" type="string">
  Mensagem de erro (quando aplic√°vel)
</ResponseField>

<ResponseField name="createdAt" type="string">
  Data/hora de cria√ß√£o do run
</ResponseField>

<ResponseExample>

```json 200 - Sucesso
[
  {
    "id": 150,
    "status": "COMPLETED",
    "scheduledFor": "2024-01-21T09:00:00",
    "startedAt": "2024-01-21T09:00:05",
    "finishedAt": "2024-01-21T09:15:32",
    "matchedContacts": 45,
    "sentCount": 45,
    "failedCount": 0,
    "errorMessage": null,
    "createdAt": "2024-01-21T09:00:00"
  },
  {
    "id": 149,
    "status": "COMPLETED",
    "scheduledFor": "2024-01-20T09:00:00",
    "startedAt": "2024-01-20T09:00:03",
    "finishedAt": "2024-01-20T09:08:17",
    "matchedContacts": 32,
    "sentCount": 30,
    "failedCount": 2,
    "errorMessage": null,
    "createdAt": "2024-01-20T09:00:00"
  },
  {
    "id": 148,
    "status": "FAILED",
    "scheduledFor": "2024-01-19T09:00:00",
    "startedAt": "2024-01-19T09:00:02",
    "finishedAt": "2024-01-19T09:00:15",
    "matchedContacts": 0,
    "sentCount": 0,
    "failedCount": 0,
    "errorMessage": "Erro ao conectar com banco de dados",
    "createdAt": "2024-01-19T09:00:00"
  }
]
```

```json 404 - N√£o Encontrada
{
  "message": "Automa√ß√£o n√£o encontrada"
}
```

```json 403 - Sem Permiss√£o
{
  "message": "Sem permiss√£o para acessar esta automa√ß√£o"
}
```

```json 401 - Token Inv√°lido
{
  "message": "Access token inv√°lido"
}
```

</ResponseExample>

## An√°lise de Performance

```javascript
// Fun√ß√£o para analisar performance das execu√ß√µes
async function analyzeAutomationPerformance(automationId, accessToken) {
  const response = await fetch(
    `https://api.disparador.com/api/automations/${automationId}/runs`,
    {
      headers: { 'X-Access-Token': accessToken }
    }
  );
  
  const runs = await response.json();
  
  // Filtrar apenas runs completos
  const completedRuns = runs.filter(r => r.status === 'COMPLETED');
  
  if (completedRuns.length === 0) {
    console.log('Nenhuma execu√ß√£o completa encontrada');
    return;
  }
  
  // Calcular m√©tricas
  const metrics = {
    totalRuns: completedRuns.length,
    totalSent: 0,
    totalFailed: 0,
    avgMatchedContacts: 0,
    avgDuration: 0,
    successRate: 0
  };
  
  completedRuns.forEach(run => {
    metrics.totalSent += run.sentCount;
    metrics.totalFailed += run.failedCount;
    metrics.avgMatchedContacts += run.matchedContacts;
    
    // Calcular dura√ß√£o
    if (run.startedAt && run.finishedAt) {
      const start = new Date(run.startedAt);
      const end = new Date(run.finishedAt);
      metrics.avgDuration += (end - start) / 1000; // segundos
    }
  });
  
  // Calcular m√©dias
  metrics.avgMatchedContacts /= completedRuns.length;
  metrics.avgDuration /= completedRuns.length;
  metrics.successRate = (metrics.totalSent / (metrics.totalSent + metrics.totalFailed)) * 100;
  
  // Exibir relat√≥rio
  console.log('üìä Relat√≥rio de Performance');
  console.log('‚îÄ'.repeat(40));
  console.log(`Total de execu√ß√µes: ${metrics.totalRuns}`);
  console.log(`Mensagens enviadas: ${metrics.totalSent}`);
  console.log(`Falhas: ${metrics.totalFailed}`);
  console.log(`Taxa de sucesso: ${metrics.successRate.toFixed(2)}%`);
  console.log(`M√©dia de contatos: ${Math.round(metrics.avgMatchedContacts)}`);
  console.log(`Dura√ß√£o m√©dia: ${Math.round(metrics.avgDuration)}s`);
  
  return metrics;
}
```

## Monitoramento de Falhas

```javascript
// Detectar e alertar sobre falhas recorrentes
async function monitorFailures(automationId, accessToken) {
  const response = await fetch(
    `https://api.disparador.com/api/automations/${automationId}/runs`,
    {
      headers: { 'X-Access-Token': accessToken }
    }
  );
  
  const runs = await response.json();
  
  // Verificar √∫ltimas 5 execu√ß√µes
  const recentRuns = runs.slice(0, 5);
  const failures = recentRuns.filter(r => r.status === 'FAILED');
  
  if (failures.length >= 3) {
    console.error('‚ö†Ô∏è ALERTA: M√∫ltiplas falhas detectadas!');
    
    failures.forEach(fail => {
      console.error(`Run #${fail.id}: ${fail.errorMessage}`);
    });
    
    // Aqui voc√™ poderia:
    // - Enviar notifica√ß√£o
    // - Desativar automa√ß√£o
    // - Criar ticket de suporte
  }
  
  return failures;
}
```

## Observa√ß√µes

<Note>
- As execu√ß√µes s√£o retornadas em ordem decrescente (mais recentes primeiro)
- N√£o h√° pagina√ß√£o - todas as execu√ß√µes s√£o retornadas
- Runs manuais (via run-now) tamb√©m aparecem na lista
- O campo `errorMessage` s√≥ √© preenchido quando h√° falha
- Execu√ß√µes canceladas podem n√£o ter `finishedAt`
</Note>


