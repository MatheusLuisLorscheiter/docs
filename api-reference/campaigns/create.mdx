---
title: "Criar Campanha"
api: "POST /api/campaigns"
description: "Cria uma nova campanha com disparo imediato ou agendado"
---

<Tip>
Cria uma nova campanha de disparo de mensagens via WhatsApp. Suporta texto, m√≠dia (imagem, v√≠deo, √°udio, documento), enquetes e agendamento.
</Tip>

<Warning>
Voc√™ precisa de um access token v√°lido no header X-Access-Token para usar este endpoint.
</Warning>

<Note>
**Filtro Autom√°tico de Contatos Bloqueados**: Os contatos que est√£o na lista de bloqueados ser√£o automaticamente removidos da campanha antes do envio. O campo `blockedContactsRemoved` no response indica quantos contatos foram filtrados.
</Note>

## Headers

<ParamField header="Content-Type" type="string" required>
  application/json
</ParamField>

<ParamField header="X-Access-Token" type="string" required>
  Token de acesso obtido no login
</ParamField>

## Body

### Informa√ß√µes B√°sicas

<ParamField body="name" type="string" required>
  Nome da campanha (obrigat√≥rio)
</ParamField>

<ParamField body="isTest" type="boolean" default="false">
  Se true, marca a campanha como teste
</ParamField>

<ParamField body="isDraft" type="boolean" default="false">
  Se true, salva a campanha como rascunho sem enviar
</ParamField>

### Configura√ß√£o Evolution API

<ParamField body="evolutionUrl" type="string" required>
  URL completa da sua Evolution API (ex: https://evolution-api.exemplo.com)
</ParamField>

<ParamField body="evolutionApiKey" type="string" required>
  API Key da sua Evolution API
</ParamField>

<ParamField body="evolutionInstance" type="string" required>
  Nome da inst√¢ncia do WhatsApp conectada
</ParamField>

### Contatos

<ParamField body="contacts" type="array" required>
  Lista de contatos que receber√£o a mensagem
  
  <Expandable title="Estrutura do contato">
    <ParamField body="phoneNumber" type="string" required>
      N√∫mero de telefone (ser√° normalizado automaticamente)
      - Formatos aceitos: 11999999999, +5511999999999, (11) 99999-9999
    </ParamField>
    <ParamField body="name" type="string">
      Nome do contato (usado nas vari√°veis {NomeCompleto} e {PrimeiroNome})
    </ParamField>
  </Expandable>
</ParamField>

### Conte√∫do da Mensagem

<ParamField body="message" type="string" conditionally_required>
  Conte√∫do da mensagem. **Obrigat√≥rio** exceto quando usando enquetes ou salvando como rascunho.
  
  Suporta vari√°veis:
  - `{PrimeiroNome}` - Primeiro nome do contato
  - `{NomeCompleto}` - Nome completo do contato
</ParamField>

### M√≠dia (Opcional)

<ParamField body="mediaUrl" type="string">
  URL do arquivo de m√≠dia ou dados em base64
  
  **URL**: https://exemplo.com/imagem.jpg
  
  **Base64**: data:image/jpeg;base64,/9j/4AAQSkZJRg...
</ParamField>

<ParamField body="mediaType" type="string" enum={["image", "video", "audio", "document"]}>
  Tipo de m√≠dia. Se n√£o fornecido, ser√° detectado automaticamente.
  - `image`: JPG, PNG, GIF
  - `video`: MP4, 3GP
  - `audio`: MP3, OGG, AAC
  - `document`: PDF, DOC, XLS, etc
</ParamField>

<ParamField body="fileName" type="string">
  Nome do arquivo (recomendado para base64 e documentos)
</ParamField>

<ParamField body="caption" type="string">
  Legenda para imagens e v√≠deos (m√°ximo 1024 caracteres)
</ParamField>

### Enquete (Opcional)

<ParamField body="pollData" type="object">
  Dados da enquete. Quando fornecido, substitui a necessidade de `message`.
  
  <Expandable title="Estrutura da enquete">
    <ParamField body="name" type="string" required>
      Pergunta da enquete
    </ParamField>
    <ParamField body="options" type="array" required>
      Op√ß√µes de resposta (m√≠nimo 2, m√°ximo 10)
      
      Cada op√ß√£o deve ser uma string √∫nica
    </ParamField>
    <ParamField body="selectableCount" type="number" default="1">
      Quantas op√ß√µes podem ser selecionadas (1-10)
    </ParamField>
  </Expandable>
</ParamField>

### Agendamento (Opcional)

<ParamField body="scheduledFor" type="string">
  Data e hora para agendamento no formato: YYYY-MM-DDTHH:mm
  
  Exemplos:
  - `2024-12-25T10:00` (formato aceito)
  - `2024-12-25T10:00:00` (tamb√©m aceito)
  
  **M√≠nimo**: 5 minutos no futuro
</ParamField>

### Configura√ß√µes de Envio

<ParamField body="intervalMinSeconds" type="number">
  Intervalo m√≠nimo entre mensagens em segundos
</ParamField>

<ParamField body="intervalMaxSeconds" type="number">
  Intervalo m√°ximo entre mensagens em segundos
</ParamField>

<ParamField body="notificationPhone" type="string">
  N√∫mero para receber notifica√ß√£o quando a campanha for conclu√≠da
</ParamField>

<RequestExample>

```bash Mensagem Simples
curl -X POST https://api.disparador.com/api/campaigns \
  -H "Content-Type: application/json" \
  -H "X-Access-Token: seu-access-token" \
  -d '{
    "name": "Campanha de Natal",
    "evolutionUrl": "https://evolution-api.exemplo.com",
    "evolutionApiKey": "sua-api-key",
    "evolutionInstance": "whatsapp-01",
    "contacts": [
      {
        "phoneNumber": "11999999999",
        "name": "Jo√£o"
      },
      {
        "phoneNumber": "11888888888",
        "name": "Maria"
      }
    ],
    "message": "Ol√° {PrimeiroNome}! Feliz Natal! üéÑ"
  }'
```

```bash Com Imagem
curl -X POST https://api.disparador.com/api/campaigns \
  -H "Content-Type: application/json" \
  -H "X-Access-Token: seu-access-token" \
  -d '{
    "name": "Promo√ß√£o com Imagem",
    "evolutionUrl": "https://evolution-api.exemplo.com",
    "evolutionApiKey": "sua-api-key",
    "evolutionInstance": "whatsapp-01",
    "contacts": [
      {
        "phoneNumber": "11999999999",
        "name": "Cliente"
      }
    ],
    "message": "Confira nossa promo√ß√£o especial!",
    "mediaUrl": "https://exemplo.com/promocao.jpg",
    "mediaType": "image",
    "caption": "50% de desconto em todos os produtos!"
  }'
```

```bash Enquete
curl -X POST https://api.disparador.com/api/campaigns \
  -H "Content-Type: application/json" \
  -H "X-Access-Token: seu-access-token" \
  -d '{
    "name": "Pesquisa de Satisfa√ß√£o",
    "evolutionUrl": "https://evolution-api.exemplo.com",
    "evolutionApiKey": "sua-api-key",
    "evolutionInstance": "whatsapp-01",
    "contacts": [
      {
        "phoneNumber": "11999999999",
        "name": "Cliente"
      }
    ],
    "pollData": {
      "name": "Como voc√™ avalia nosso atendimento?",
      "options": ["Excelente", "Bom", "Regular", "Ruim"],
      "selectableCount": 1
    }
  }'
```

```bash Agendada
curl -X POST https://api.disparador.com/api/campaigns \
  -H "Content-Type: application/json" \
  -H "X-Access-Token: seu-access-token" \
  -d '{
    "name": "Lembrete Agendado",
    "evolutionUrl": "https://evolution-api.exemplo.com",
    "evolutionApiKey": "sua-api-key",
    "evolutionInstance": "whatsapp-01",
    "contacts": [
      {
        "phoneNumber": "11999999999",
        "name": "Jo√£o"
      }
    ],
    "message": "Ol√° {PrimeiroNome}! N√£o esque√ßa da sua consulta amanh√£ √†s 10h.",
    "scheduledFor": "2024-12-25T09:00"
  }'
```

</RequestExample>

```javascript JavaScript
const campaignData = {
  name: "Campanha de Natal",
  evolutionUrl: "https://evolution-api.exemplo.com",
  evolutionApiKey: "sua-api-key",
  evolutionInstance: "whatsapp-01",
  contacts: [
    {
      phoneNumber: "11999999999",
      name: "Jo√£o"
    },
    {
      phoneNumber: "11888888888",
      name: "Maria"
    }
  ],
  message: "Ol√° {PrimeiroNome}! Feliz Natal! üéÑ",
  intervalMinSeconds: 3,
  intervalMaxSeconds: 5
};

const response = await fetch('https://api.disparador.com/api/campaigns', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'X-Access-Token': 'seu-access-token'
  },
  body: JSON.stringify(campaignData)
});

const result = await response.json();
if (result.id) {
  console.log(`Campanha criada com ID: ${result.id}`);
  console.log(`Status: ${result.status}`);
  console.log(`Total de contatos: ${result.totalContacts}`);
} else {
  console.error('Erro:', result.message);
}
```

```python Python
import requests
import json

url = "https://api.disparador.com/api/campaigns"
headers = {
    'Content-Type': 'application/json',
    'X-Access-Token': 'seu-access-token'
}

# Campanha com m√≠dia
data = {
    "name": "Promo√ß√£o Black Friday",
    "evolutionUrl": "https://evolution-api.exemplo.com",
    "evolutionApiKey": "sua-api-key",
    "evolutionInstance": "whatsapp-01",
    "contacts": [
        {
            "phoneNumber": "11999999999",
            "name": "Cliente VIP"
        }
    ],
    "message": "Ol√° {PrimeiroNome}! Aproveite nossa Black Friday!",
    "mediaUrl": "https://exemplo.com/black-friday.jpg",
    "mediaType": "image",
    "caption": "At√© 70% de desconto!"
}

response = requests.post(url, json=data, headers=headers)
result = response.json()

if result.get('id'):
    print(f"Campanha criada com sucesso!")
    print(f"ID: {result['id']}")
    print(f"Status: {result['status']}")
else:
    print(f"Erro: {result.get('message')}")
```

```php PHP
<?php
$url = 'https://api.disparador.com/api/campaigns';
$headers = [
    'Content-Type: application/json',
    'X-Access-Token: seu-access-token'
];

// Campanha com enquete
$data = [
    'name' => 'Pesquisa de Satisfa√ß√£o',
    'evolutionUrl' => 'https://evolution-api.exemplo.com',
    'evolutionApiKey' => 'sua-api-key',
    'evolutionInstance' => 'whatsapp-01',
    'contacts' => [
        [
            'phoneNumber' => '11999999999',
            'name' => 'Cliente'
        ]
    ],
    'pollData' => [
        'name' => 'Como voc√™ avalia nosso produto?',
        'options' => ['Excelente', 'Bom', 'Regular', 'Ruim'],
        'selectableCount' => 1
    ]
];

$options = [
    'http' => [
        'header' => implode("\r\n", $headers),
        'method' => 'POST',
        'content' => json_encode($data)
    ]
];

$context = stream_context_create($options);
$result = file_get_contents($url, false, $context);
$response = json_decode($result, true);

if (isset($response['id'])) {
    echo "Campanha criada com ID: " . $response['id'] . "\n";
    echo "Status: " . $response['status'] . "\n";
} else {
    echo "Erro: " . $response['message'] . "\n";
}
?>
```

## Response

<ResponseField name="id" type="number">
  ID √∫nico da campanha criada
</ResponseField>

<ResponseField name="name" type="string">
  Nome da campanha
</ResponseField>

<ResponseField name="status" type="string">
  Status atual da campanha
  - `DRAFT` - Rascunho
  - `SCHEDULED` - Agendada
  - `ACTIVE` - Em execu√ß√£o
  - `PAUSED` - Pausada
  - `COMPLETED` - Conclu√≠da
  - `CANCELLED` - Cancelada
  - `FAILED` - Falhou
</ResponseField>

<ResponseField name="companyId" type="number">
  ID da empresa propriet√°ria
</ResponseField>

<ResponseField name="totalContacts" type="number">
  Total de contatos na campanha
</ResponseField>

<ResponseField name="blockedContactsRemoved" type="number">
  Quantidade de contatos bloqueados que foram removidos
</ResponseField>

<ResponseField name="sentCount" type="number">
  Quantidade de mensagens enviadas
</ResponseField>

<ResponseField name="failedCount" type="number">
  Quantidade de envios que falharam
</ResponseField>

<ResponseField name="scheduledFor" type="string">
  Data/hora de agendamento (se aplic√°vel)
</ResponseField>

<ResponseField name="createdAt" type="string">
  Data/hora de cria√ß√£o
</ResponseField>

<ResponseField name="updatedAt" type="string">
  Data/hora da √∫ltima atualiza√ß√£o
</ResponseField>

<ResponseField name="message" type="string">
  Mensagem de erro (apenas em caso de falha)
</ResponseField>

<ResponseExample>

```json 200 - Sucesso
{
  "id": 123,
  "name": "Campanha de Natal",
  "status": "ACTIVE",
  "companyId": 1,
  "totalContacts": 2,
  "blockedContactsRemoved": 0,
  "sentCount": 0,
  "failedCount": 0,
  "scheduledFor": null,
  "createdAt": "2024-01-20T10:30:00",
  "updatedAt": "2024-01-20T10:30:00"
}
```

```json 200 - Sucesso (Agendada)
{
  "id": 124,
  "name": "Lembrete Agendado",
  "status": "SCHEDULED",
  "companyId": 1,
  "totalContacts": 1,
  "blockedContactsRemoved": 0,
  "sentCount": 0,
  "failedCount": 0,
  "scheduledFor": "2024-12-25T09:00:00",
  "createdAt": "2024-01-20T10:30:00",
  "updatedAt": "2024-01-20T10:30:00"
}
```

```json 200 - Sucesso (Com Bloqueios)
{
  "id": 125,
  "name": "Promo√ß√£o",
  "status": "ACTIVE",
  "companyId": 1,
  "totalContacts": 8,
  "blockedContactsRemoved": 2,
  "sentCount": 0,
  "failedCount": 0,
  "scheduledFor": null,
  "createdAt": "2024-01-20T10:30:00",
  "updatedAt": "2024-01-20T10:30:00"
}
```

```json 400 - Token Inv√°lido
{
  "message": "Access token inv√°lido"
}
```

```json 400 - Valida√ß√£o
{
  "message": "Nome da campanha √© obrigat√≥rio"
}
```

```json 400 - Sem Contatos V√°lidos
{
  "message": "Nenhum contato v√°lido encontrado ap√≥s remover bloqueados"
}
```

</ResponseExample>

## Valida√ß√µes

<Warning>
- **Nome**: Obrigat√≥rio
- **Mensagem**: Obrigat√≥ria (exceto para enquetes ou rascunhos)
- **Contatos**: Pelo menos 1 contato v√°lido
- **Enquete**: 2-10 op√ß√µes √∫nicas
- **Agendamento**: M√≠nimo 5 minutos no futuro
- **Evolution API**: Credenciais v√°lidas e inst√¢ncia conectada
</Warning>

## Limites

<Note>
- **Contatos por campanha**: Sem limite definido (recomendado at√© 10.000)
- **Tamanho da mensagem**: 4096 caracteres
- **Tamanho da legenda**: 1024 caracteres
- **Op√ß√µes de enquete**: 2-10 op√ß√µes
- **Arquivo de m√≠dia**: Depende dos limites do WhatsApp
</Note>

## Vari√°veis de Personaliza√ß√£o

Voc√™ pode usar as seguintes vari√°veis nas mensagens:
- `{PrimeiroNome}` - Primeiro nome do contato
- `{NomeCompleto}` - Nome completo do contato

<Info>
  Suporta vari√°veis de personaliza√ß√£o:
  
  ```text
  Ol√° {PrimeiroNome}!
  
  Seu nome completo {NomeCompleto} foi selecionado para uma oferta especial.
  ```
</Info>

## Webhooks

A campanha enviar√° notifica√ß√µes via webhook nos seguintes eventos:

- **campaign.started** - Quando a campanha iniciar
- **campaign.progress** - A cada 10% de progresso
- **campaign.completed** - Quando finalizar
- **campaign.failed** - Se falhar

Configure o webhook no painel de configura√ß√µes da empresa.
