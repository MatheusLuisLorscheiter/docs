---
title: "Listar Campanhas Ativas"
api: "GET /api/campaigns/active"
description: "Lista todas as campanhas ativas (em execução ou agendadas) da empresa"
---

## Visão Geral

Este endpoint retorna uma lista de todas as campanhas que estão atualmente ativas, incluindo:
- Campanhas em execução (RUNNING)
- Campanhas agendadas (SCHEDULED)
- Campanhas pausadas (PAUSED)

É útil para monitorar campanhas em andamento e gerenciar operações ativas.

## Requisitos

- Token de acesso válido
- Permissão para visualizar campanhas da empresa

## Cabeçalhos

<ParamField header="X-Access-Token" type="string" required>
  Token de acesso da empresa
</ParamField>

## Exemplos de Uso

### cURL
```bash
curl -X GET https://api.disparador.com/api/campaigns/active \
  -H "X-Access-Token: seu_token_aqui"
```

### JavaScript
```javascript
const response = await fetch('https://api.disparador.com/api/campaigns/active', {
  headers: {
    'X-Access-Token': 'seu_token_aqui'
  }
});

const activeCampaigns = await response.json();
console.log(`${activeCampaigns.length} campanhas ativas encontradas`);
```

### Python
```python
import requests

url = "https://api.disparador.com/api/campaigns/active"
headers = {
    "X-Access-Token": "seu_token_aqui"
}

response = requests.get(url, headers=headers)
campaigns = response.json()

for campaign in campaigns:
    print(f"{campaign['name']} - Status: {campaign['status']}")
```

### PHP
```php
$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, "https://api.disparador.com/api/campaigns/active");
curl_setopt($ch, CURLOPT_HTTPHEADER, [
    'X-Access-Token: seu_token_aqui'
]);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);

$response = curl_exec($ch);
$campaigns = json_decode($response, true);

foreach ($campaigns as $campaign) {
    echo $campaign['name'] . " - " . $campaign['status'] . "\n";
}
```

## Resposta

### Sucesso (200 OK)

Retorna um array de campanhas ativas com suas estatísticas:

```json
[
  {
    "id": 123,
    "name": "Promoção Black Friday",
    "description": "Campanha promocional",
    "status": "RUNNING",
    "type": "IMMEDIATE",
    "startedAt": "2024-01-20T10:00:00",
    "totalContacts": 500,
    "sentContacts": 245,
    "failedContacts": 5,
    "pendingContacts": 250,
    "progressPercentage": 50.0,
    "successRate": 98.0,
    "estimatedCompletion": "2024-01-20T14:30:00"
  },
  {
    "id": 124,
    "name": "Lembrete de Evento",
    "status": "SCHEDULED",
    "type": "SCHEDULED",
    "scheduledFor": "2024-01-21T09:00:00",
    "totalContacts": 150,
    "sentContacts": 0,
    "failedContacts": 0,
    "pendingContacts": 150,
    "progressPercentage": 0.0
  },
  {
    "id": 125,
    "name": "Newsletter Semanal",
    "status": "PAUSED",
    "type": "IMMEDIATE",
    "startedAt": "2024-01-20T08:00:00",
    "pausedAt": "2024-01-20T12:00:00",
    "totalContacts": 1000,
    "sentContacts": 600,
    "failedContacts": 10,
    "pendingContacts": 390,
    "progressPercentage": 61.0,
    "successRate": 98.4
  }
]
```

## Campos da Resposta

<ResponseField name="id" type="number">
  ID único da campanha
</ResponseField>

<ResponseField name="name" type="string">
  Nome da campanha
</ResponseField>

<ResponseField name="description" type="string">
  Descrição da campanha
</ResponseField>

<ResponseField name="status" type="string">
  Status atual: RUNNING, SCHEDULED, PAUSED
</ResponseField>

<ResponseField name="type" type="string">
  Tipo: IMMEDIATE ou SCHEDULED
</ResponseField>

<ResponseField name="startedAt" type="string">
  Data/hora de início (para campanhas em execução)
</ResponseField>

<ResponseField name="scheduledFor" type="string">
  Data/hora agendada (para campanhas agendadas)
</ResponseField>

<ResponseField name="pausedAt" type="string">
  Data/hora da pausa (para campanhas pausadas)
</ResponseField>

<ResponseField name="totalContacts" type="number">
  Total de contatos na campanha
</ResponseField>

<ResponseField name="sentContacts" type="number">
  Quantidade de mensagens enviadas com sucesso
</ResponseField>

<ResponseField name="failedContacts" type="number">
  Quantidade de mensagens que falharam
</ResponseField>

<ResponseField name="pendingContacts" type="number">
  Quantidade de mensagens pendentes
</ResponseField>

<ResponseField name="progressPercentage" type="number">
  Percentual de progresso (0-100)
</ResponseField>

<ResponseField name="successRate" type="number">
  Taxa de sucesso em percentual
</ResponseField>

<ResponseField name="estimatedCompletion" type="string">
  Estimativa de conclusão (para campanhas em execução)
</ResponseField>

## Casos de Uso

### 1. Dashboard de Monitoramento
```javascript
async function updateDashboard() {
  const campaigns = await fetch('/api/campaigns/active', {
    headers: { 'X-Access-Token': token }
  }).then(r => r.json());

  const running = campaigns.filter(c => c.status === 'RUNNING');
  const scheduled = campaigns.filter(c => c.status === 'SCHEDULED');
  const paused = campaigns.filter(c => c.status === 'PAUSED');

  console.log(`Em execução: ${running.length}`);
  console.log(`Agendadas: ${scheduled.length}`);
  console.log(`Pausadas: ${paused.length}`);

  // Atualizar UI
  updateProgressBars(running);
  showScheduledCampaigns(scheduled);
  highlightPausedCampaigns(paused);
}
```

### 2. Alertas de Campanhas Pausadas
```javascript
async function checkPausedCampaigns() {
  const campaigns = await getCampaignsActive();
  const paused = campaigns.filter(c => c.status === 'PAUSED');
  
  for (const campaign of paused) {
    const pausedHours = calculateHoursSince(campaign.pausedAt);
    
    if (pausedHours > 24) {
      sendAlert(`Campanha "${campaign.name}" pausada há ${pausedHours}h`);
    }
  }
}
```

### 3. Estimativa de Recursos
```javascript
async function estimateSystemLoad() {
  const campaigns = await getCampaignsActive();
  
  const totalPending = campaigns.reduce(
    (sum, c) => sum + c.pendingContacts, 0
  );
  
  const avgSendRate = calculateAverageSendRate(campaigns);
  const estimatedTime = totalPending / avgSendRate;
  
  console.log(`Mensagens pendentes: ${totalPending}`);
  console.log(`Tempo estimado: ${estimatedTime} minutos`);
}
```

### 4. Relatório de Performance
```javascript
async function generatePerformanceReport() {
  const campaigns = await getCampaignsActive();
  
  const report = campaigns.map(campaign => ({
    name: campaign.name,
    progress: `${campaign.progressPercentage}%`,
    success: `${campaign.successRate}%`,
    eta: campaign.estimatedCompletion || 'N/A'
  }));
  
  return report;
}
```

## Observações

<Note>
  **Filtragem Automática:**
  - Apenas campanhas com status RUNNING, SCHEDULED ou PAUSED são retornadas
  - Campanhas concluídas, canceladas ou em rascunho não aparecem
  - A lista é ordenada por data de criação (mais recentes primeiro)
</Note>

<Warning>
  **Performance:**
  - Para empresas com muitas campanhas ativas, considere implementar paginação
  - As estatísticas são calculadas em tempo real e podem impactar a performance
  - Use este endpoint com moderação em loops ou polling frequente
</Warning>

## Diferenças do Endpoint `/api/campaigns`

| Característica | `/api/campaigns` | `/api/campaigns/active` |
|----------------|------------------|------------------------|
| Filtros | Aceita parâmetro `status` | Filtra automaticamente |
| Campanhas incluídas | Todas | Apenas RUNNING, SCHEDULED, PAUSED |
| Performance | Pode ser mais lento | Otimizado para ativos |
| Uso recomendado | Listagem completa | Monitoramento em tempo real |