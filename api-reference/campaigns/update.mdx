---
title: "Atualizar Campanha"
api: "PUT /api/campaigns/{id}"
description: "Atualiza uma campanha em rascunho com novos dados"
---

## Vis√£o Geral

Este endpoint permite atualizar uma campanha que esteja com status **DRAFT** (rascunho). Voc√™ pode modificar:
- Nome e descri√ß√£o
- Lista de contatos
- Mensagem e m√≠dia
- Intervalos de envio
- Agendamento
- Telefone de notifica√ß√£o
- Configura√ß√µes da Evolution API

## Requisitos

- Token de acesso v√°lido
- ID da campanha a ser atualizada
- A campanha deve estar em status DRAFT
- A campanha deve pertencer √† empresa do usu√°rio

## Par√¢metros

<ParamField path="id" type="number" required>
  ID da campanha a ser atualizada
</ParamField>

<ParamField body="name" type="string" required>
  Nome da campanha
</ParamField>

<ParamField body="message" type="string">
  Conte√∫do da mensagem (obrigat√≥rio se n√£o for enquete)
</ParamField>

<ParamField body="contacts" type="array" required>
  Lista de contatos para a campanha
  ```json
  [
    {
      "phoneNumber": "5511999887766",
      "name": "Jo√£o Silva"
    }
  ]
  ```
</ParamField>

### Configura√ß√£o Evolution API

<ParamField body="evolutionUrl" type="string" required>
  URL completa da sua Evolution API (ex: https://evolution-api.exemplo.com)
</ParamField>

<ParamField body="evolutionApiKey" type="string" required>
  API Key da sua Evolution API
</ParamField>

<ParamField body="evolutionInstance" type="string" required>
  Nome da inst√¢ncia do WhatsApp conectada
</ParamField>

<ParamField body="evolutionConfigId" type="number">
  ID de uma configura√ß√£o Evolution salva (alternativa aos campos acima)
</ParamField>

### Agendamento e Intervalos

<ParamField body="scheduledFor" type="string">
  Data/hora para agendamento (ISO 8601)
</ParamField>

<ParamField body="intervalMinSeconds" type="number">
  Intervalo m√≠nimo entre mensagens (padr√£o: 10)
</ParamField>

<ParamField body="intervalMaxSeconds" type="number">
  Intervalo m√°ximo entre mensagens (padr√£o: 30)
</ParamField>

<ParamField body="notificationPhone" type="string">
  Telefone para notifica√ß√£o de conclus√£o
</ParamField>

### M√≠dia e Enquetes

<ParamField body="mediaUrl" type="string">
  URL da m√≠dia a ser enviada
</ParamField>

<ParamField body="mediaType" type="string">
  Tipo de m√≠dia: image, video, audio, document
</ParamField>

<ParamField body="caption" type="string">
  Legenda para m√≠dia (imagens e v√≠deos)
</ParamField>

<ParamField body="fileName" type="string">
  Nome do arquivo para documentos
</ParamField>

<ParamField body="pollData" type="object">
  Dados da enquete
  ```json
  {
    "name": "Pergunta da enquete",
    "options": ["Op√ß√£o 1", "Op√ß√£o 2"],
    "selectableCount": 1
  }
  ```
</ParamField>

### Configura√ß√µes Adicionais

<ParamField body="isDraft" type="boolean">
  Se true, mant√©m como rascunho. Se false, inicia/agenda a campanha
</ParamField>

<ParamField body="isTest" type="boolean">
  Se true, marca a campanha como teste
</ParamField>

<ParamField body="databaseConfigId" type="number">
  ID da configura√ß√£o de banco para vari√°veis personalizadas
</ParamField>

## Cabe√ßalhos

<ParamField header="X-Access-Token" type="string" required>
  Token de acesso da empresa
</ParamField>

## Exemplos de Uso

### Atualizar e Manter como Rascunho
```javascript
const response = await fetch('https://api.disparador.com/api/campaigns/123', {
  method: 'PUT',
  headers: {
    'X-Access-Token': 'seu_token_aqui',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    name: 'Campanha Atualizada',
    message: 'Nova mensagem da campanha',
    evolutionUrl: 'https://evolution-api.exemplo.com',
    evolutionApiKey: 'sua-api-key',
    evolutionInstance: 'whatsapp-01',
    contacts: [
      { phoneNumber: '5511999887766', name: 'Jo√£o' },
      { phoneNumber: '5511999887777', name: 'Maria' }
    ],
    intervalMinSeconds: 5,
    intervalMaxSeconds: 20,
    isDraft: true
  })
});
```

### Atualizar e Iniciar Campanha
```javascript
const response = await fetch('https://api.disparador.com/api/campaigns/123', {
  method: 'PUT',
  headers: {
    'X-Access-Token': 'seu_token_aqui',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    name: 'Promo√ß√£o Rel√¢mpago',
    message: '‚ö° Oferta v√°lida apenas hoje!',
    evolutionUrl: 'https://evolution-api.exemplo.com',
    evolutionApiKey: 'sua-api-key',
    evolutionInstance: 'whatsapp-01',
    contacts: contactList,
    isDraft: false // Inicia imediatamente
  })
});
```

### Atualizar usando Configura√ß√£o Salva
```javascript
const response = await fetch('https://api.disparador.com/api/campaigns/123', {
  method: 'PUT',
  headers: {
    'X-Access-Token': 'seu_token_aqui',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    name: 'Campanha com Config Salva',
    message: 'Usando configura√ß√£o Evolution predefinida',
    evolutionConfigId: 5, // Usa configura√ß√£o salva ao inv√©s de especificar URL/Key/Instance
    contacts: customerList,
    isDraft: false
  })
});
```

### Atualizar e Agendar
```javascript
const response = await fetch('https://api.disparador.com/api/campaigns/123', {
  method: 'PUT',
  headers: {
    'X-Access-Token': 'seu_token_aqui',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    name: 'Lembrete Agendado',
    message: 'N√£o esque√ßa do nosso evento amanh√£!',
    evolutionUrl: 'https://evolution-api.exemplo.com',
    evolutionApiKey: 'sua-api-key',
    evolutionInstance: 'whatsapp-01',
    contacts: eventParticipants,
    scheduledFor: '2024-01-21T09:00:00',
    isDraft: false
  })
});
```

### Atualizar para Campanha com M√≠dia
```javascript
const response = await fetch('https://api.disparador.com/api/campaigns/123', {
  method: 'PUT',
  headers: {
    'X-Access-Token': 'seu_token_aqui',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    name: 'Lan√ßamento com V√≠deo',
    message: 'Confira nosso novo produto em a√ß√£o!',
    mediaUrl: 'https://example.com/video.mp4',
    mediaType: 'video',
    caption: 'Novo produto revolucion√°rio',
    evolutionUrl: 'https://evolution-api.exemplo.com',
    evolutionApiKey: 'sua-api-key',
    evolutionInstance: 'whatsapp-01',
    contacts: customerList,
    isDraft: true
  })
});
```

### Atualizar para Enquete
```javascript
const response = await fetch('https://api.disparador.com/api/campaigns/123', {
  method: 'PUT',
  headers: {
    'X-Access-Token': 'seu_token_aqui',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    name: 'Pesquisa de Satisfa√ß√£o',
    pollData: {
      name: 'Como voc√™ avalia nosso atendimento?',
      options: ['Excelente', 'Bom', 'Regular', 'Ruim'],
      selectableCount: 1
    },
    evolutionUrl: 'https://evolution-api.exemplo.com',
    evolutionApiKey: 'sua-api-key',
    evolutionInstance: 'whatsapp-01',
    contacts: clientList,
    isDraft: false
  })
});
```

## Resposta

A estrutura de resposta segue o mesmo padr√£o do endpoint de cria√ß√£o de campanhas.

### Sucesso (200 OK)

#### Mantida como Rascunho
```json
{
  "id": 123,
  "name": "Campanha Atualizada",
  "description": null,
  "status": "DRAFT",
  "type": "TEXT",
  "createdAt": "2024-01-20T10:30:00",
  "scheduledFor": null,
  "totalContacts": 50,
  "sentContacts": 0,
  "failedContacts": 0,
  "pendingContacts": 50,
  "progressPercentage": 0,
  "successRate": 0,
  "messageContent": "Nova mensagem da campanha",
  "mediaType": null,
  "mediaUrl": null,
  "fileName": null,
  "evolutionInstance": "whatsapp-01",
  "minInterval": 5,
  "maxInterval": 20,
  "notificationPhone": null,
  "pollData": null,
  "evolutionConfig": {
    "id": 1,
    "name": "WhatsApp Principal",
    "url": "https://evolution-api.exemplo.com",
    "instance": "whatsapp-01"
  },
  "message": "Campanha atualizada com sucesso"
}
```

#### Iniciada Imediatamente
```json
{
  "id": 123,
  "name": "Promo√ß√£o Rel√¢mpago",
  "description": null,
  "status": "ACTIVE",
  "type": "TEXT",
  "createdAt": "2024-01-20T10:30:00",
  "startedAt": "2024-01-20T16:30:00",
  "scheduledFor": null,
  "totalContacts": 100,
  "sentContacts": 0,
  "failedContacts": 0,
  "pendingContacts": 100,
  "progressPercentage": 0,
  "successRate": 0,
  "messageContent": "‚ö° Oferta v√°lida apenas hoje!",
  "mediaType": null,
  "mediaUrl": null,
  "fileName": null,
  "evolutionInstance": "whatsapp-01",
  "minInterval": 10,
  "maxInterval": 30,
  "notificationPhone": null,
  "pollData": null,
  "evolutionConfig": {
    "id": 1,
    "name": "WhatsApp Principal",
    "url": "https://evolution-api.exemplo.com",
    "instance": "whatsapp-01"
  }
}
```

#### Agendada
```json
{
  "id": 123,
  "name": "Lembrete Agendado",
  "description": null,
  "status": "SCHEDULED",
  "type": "TEXT",
  "createdAt": "2024-01-20T10:30:00",
  "scheduledFor": "2024-01-21T09:00:00",
  "totalContacts": 75,
  "sentContacts": 0,
  "failedContacts": 0,
  "pendingContacts": 75,
  "progressPercentage": 0,
  "successRate": 0,
  "messageContent": "N√£o esque√ßa do nosso evento amanh√£!",
  "mediaType": null,
  "mediaUrl": null,
  "fileName": null,
  "evolutionInstance": "whatsapp-01",
  "minInterval": 10,
  "maxInterval": 30,
  "notificationPhone": null,
  "pollData": null,
  "evolutionConfig": {
    "id": 1,
    "name": "WhatsApp Principal",
    "url": "https://evolution-api.exemplo.com",
    "instance": "whatsapp-01"
  }
}
```

## Erros Comuns

### 400 Bad Request - Campanha n√£o encontrada
```json
{
  "message": "Campanha n√£o encontrada"
}
```

### 403 Forbidden - Acesso negado
```json
{
  "message": "Acesso negado"
}
```

### 400 Bad Request - Status inv√°lido
```json
{
  "message": "Apenas campanhas em rascunho podem ser editadas"
}
```

### 400 Bad Request - Valida√ß√£o
```json
{
  "message": "Mensagem √© obrigat√≥ria quando n√£o for enquete ou rascunho"
}
```

## Valida√ß√µes

<Note>
  **Regras de Valida√ß√£o:**
  - Nome √© sempre obrigat√≥rio
  - Mensagem √© obrigat√≥ria exceto para enquetes ou quando `isDraft = true`
  - Intervalos devem respeitar: 1 ‚â§ min ‚â§ 300 e min ‚â§ max ‚â§ 600
  - Para enquetes, `pollData` deve ter no m√≠nimo 2 op√ß√µes e no m√°ximo 10
  - Contatos bloqueados s√£o automaticamente filtrados
  - Evolution API deve ter credenciais v√°lidas ou evolutionConfigId v√°lido
</Note>

<Warning>
  **Limita√ß√µes:**
  - Apenas campanhas em status DRAFT podem ser atualizadas
  - Ap√≥s iniciar, a campanha n√£o pode mais ser editada
  - M√°ximo de 600 segundos (10 minutos) para intervalo entre mensagens
</Warning>

## Fluxo de Trabalho

### 1. Criar e Refinar Rascunho
```javascript
// Criar rascunho inicial
const draft = await createCampaign({
  name: 'Campanha Inicial',
  message: 'Texto b√°sico',
  evolutionUrl: 'https://evolution-api.exemplo.com',
  evolutionApiKey: 'sua-api-key',
  evolutionInstance: 'whatsapp-01',
  contacts: [],
  isDraft: true
});

// Refinar mensagem
await updateCampaign(draft.id, {
  message: 'Mensagem melhorada com emojis üéâ',
  isDraft: true
});

// Adicionar contatos
await updateCampaign(draft.id, {
  contacts: await loadContacts(),
  isDraft: true
});

// Finalmente, iniciar
await updateCampaign(draft.id, {
  isDraft: false
});
```

### 2. Converter Tipos de Campanha
```javascript
// Converter de texto para m√≠dia
await updateCampaign(campaignId, {
  mediaUrl: 'https://example.com/promo.jpg',
  mediaType: 'image',
  caption: 'Super promo√ß√£o!',
  isDraft: true
});

// Converter para enquete
await updateCampaign(campaignId, {
  pollData: {
    name: 'Qual seu sabor favorito?',
    options: ['Chocolate', 'Morango', 'Baunilha'],
    selectableCount: 1
  },
  isDraft: true
});
```

### 3. Preparar Campanha Complexa
```javascript
// Atualizar com vari√°veis personalizadas
await updateCampaign(campaignId, {
  message: 'Ol√° {PrimeiroNome}, sua fatura de {{valor}} vence em {{data}}',
  databaseConfigId: 123,
  contacts: clientsWithCustomData,
  isDraft: true
});

// Revisar e agendar
await updateCampaign(campaignId, {
  scheduledFor: '2024-02-01T08:00:00',
  notificationPhone: '5511999887766',
  isDraft: false
});
```