---
title: "Cancelar Campanha"
api: "PUT /api/campaigns/{id}/cancel"
description: "Cancela permanentemente uma campanha"
---

<Tip>
Cancela uma campanha de forma permanente. Esta ação não pode ser desfeita.
</Tip>

<Warning>
O cancelamento é irreversível. Uma campanha cancelada não pode ser retomada.
</Warning>

## Headers

<ParamField header="X-Access-Token" type="string" required>
  Token de acesso da empresa
</ParamField>

## Path Parameters

<ParamField path="id" type="number" required>
  ID da campanha a ser cancelada
</ParamField>

<RequestExample>

```bash cURL
curl -X PUT https://api.disparador.com/api/campaigns/123/cancel \
  -H "X-Access-Token: seu-access-token"
```

```javascript JavaScript
const campaignId = 123;

// Confirmar antes de cancelar
if (confirm('Tem certeza que deseja cancelar esta campanha? Esta ação não pode ser desfeita.')) {
  const response = await fetch(`https://api.disparador.com/api/campaigns/${campaignId}/cancel`, {
    method: 'PUT',
    headers: {
      'X-Access-Token': 'seu-access-token'
    }
  });
  
  const result = await response.json();
  
  if (result.id) {
    console.log(`Campanha ${result.name} cancelada permanentemente`);
    console.log(`Total enviado antes do cancelamento: ${result.sentCount}`);
  } else {
    console.error('Erro:', result.message);
  }
}
```

```python Python
import requests

campaign_id = 123
url = f"https://api.disparador.com/api/campaigns/{campaign_id}/cancel"
headers = {
    'X-Access-Token': 'seu-access-token'
}

# Confirmar antes de cancelar
confirm = input(f"Cancelar campanha {campaign_id}? (s/n): ")

if confirm.lower() == 's':
    response = requests.put(url, headers=headers)
    result = response.json()
    
    if 'id' in result:
        print(f"Campanha '{result['name']}' cancelada permanentemente")
        print(f"Mensagens enviadas antes do cancelamento: {result['sentCount']}")
        print(f"Status final: {result['status']}")
    else:
        print(f"Erro: {result.get('message')}")
else:
    print("Cancelamento abortado")
```

```php PHP
<?php
$campaignId = 123;
$url = "https://api.disparador.com/api/campaigns/{$campaignId}/cancel";

// Confirmar antes de cancelar
echo "Tem certeza que deseja cancelar a campanha {$campaignId}? (s/n): ";
$handle = fopen("php://stdin", "r");
$confirm = trim(fgets($handle));
fclose($handle);

if (strtolower($confirm) === 's') {
    $options = [
        'http' => [
            'header' => "X-Access-Token: seu-access-token\r\n",
            'method' => 'PUT'
        ]
    ];
    
    $context = stream_context_create($options);
    $result = file_get_contents($url, false, $context);
    $response = json_decode($result, true);
    
    if (isset($response['id'])) {
        echo "Campanha '{$response['name']}' cancelada permanentemente\n";
        echo "Total enviado: {$response['sentCount']}\n";
        echo "Status: {$response['status']}\n";
    } else {
        echo "Erro: " . $response['message'] . "\n";
    }
} else {
    echo "Cancelamento abortado\n";
}
?>
```

</RequestExample>

## Response

Retorna os dados finais da campanha após cancelamento.

<ResponseField name="id" type="number">
  ID da campanha
</ResponseField>

<ResponseField name="name" type="string">
  Nome da campanha
</ResponseField>

<ResponseField name="status" type="string">
  Novo status (será "CANCELLED")
</ResponseField>

<ResponseField name="totalContacts" type="number">
  Total de contatos que estavam na campanha
</ResponseField>

<ResponseField name="sentCount" type="number">
  Total de mensagens enviadas antes do cancelamento
</ResponseField>

<ResponseField name="failedCount" type="number">
  Total de falhas antes do cancelamento
</ResponseField>

<ResponseField name="cancelledAt" type="string">
  Data/hora do cancelamento
</ResponseField>

<ResponseField name="cancelledBy" type="string">
  Email do usuário que cancelou (baseado no token)
</ResponseField>

<ResponseField name="message" type="string">
  Mensagem de erro (apenas em caso de falha)
</ResponseField>

<ResponseExample>

```json 200 - Sucesso
{
  "id": 123,
  "name": "Campanha de Vendas",
  "status": "CANCELLED",
  "companyId": 1,
  "totalContacts": 500,
  "sentCount": 234,
  "failedCount": 5,
  "cancelledAt": "2024-01-20T17:00:00",
  "cancelledBy": "admin@empresa.com",
  "message": null
}
```

```json 400 - Campanha Já Finalizada
{
  "message": "Campanhas concluídas não podem ser canceladas"
}
```

```json 400 - Campanha Já Cancelada
{
  "message": "Esta campanha já foi cancelada"
}
```

```json 400 - Campanha Não Encontrada
{
  "message": "Campanha não encontrada ou não pertence à sua empresa"
}
```

```json 400 - Token Inválido
{
  "message": "Access token inválido"
}
```

</ResponseExample>

## Quando Cancelar

Uma campanha pode ser cancelada quando está nos seguintes status:

<CardGroup cols={2}>
  <Card title="SCHEDULED" icon="calendar" color="#2563eb">
    Cancelar antes de iniciar
  </Card>
  <Card title="ACTIVE" icon="play" color="#16a34a">
    Interromper envio em andamento
  </Card>
  <Card title="PAUSED" icon="pause" color="#f59e0b">
    Desistir de campanha pausada
  </Card>
  <Card title="DRAFT" icon="file" color="#6b7280">
    Excluir rascunho não utilizado
  </Card>
</CardGroup>

## Não Pode Cancelar

<CardGroup cols={2}>
  <Card title="COMPLETED" icon="check-circle" color="#10b981">
    Já foi concluída
  </Card>
  <Card title="CANCELLED" icon="x-circle" color="#ef4444">
    Já está cancelada
  </Card>
</CardGroup>

## Consequências do Cancelamento

<Warning>
1. **Parada imediata** - Nenhuma nova mensagem será enviada
2. **Irreversível** - Não é possível retomar uma campanha cancelada
3. **Estatísticas preservadas** - Dados de envio são mantidos para consulta
4. **Contatos não notificados** - Destinatários restantes não receberão a mensagem
</Warning>

## Alternativas ao Cancelamento

Antes de cancelar, considere:

```javascript
// Função para avaliar se deve pausar ou cancelar
async function evaluateCampaignAction(campaignId, accessToken) {
  const response = await fetch(
    `https://api.disparador.com/api/campaigns/${campaignId}`,
    {
      headers: { 'X-Access-Token': accessToken }
    }
  );
  
  const campaign = await response.json();
  const progress = (campaign.sentCount / campaign.totalContacts) * 100;
  
  if (progress < 10) {
    console.log('Menos de 10% enviado - considere cancelar');
    return 'CANCEL';
  } else if (progress < 50) {
    console.log('Entre 10-50% enviado - considere pausar e revisar');
    return 'PAUSE';
  } else {
    console.log('Mais de 50% enviado - considere deixar completar');
    return 'CONTINUE';
  }
}
```

## Auditoria

<Note>
Todos os cancelamentos são registrados com:
- Data e hora exata
- Usuário responsável (via token)
- Estado da campanha no momento
- Motivo (se implementado no futuro)
</Note>