---
title: "Configura√ß√£o"
description: "Configura√ß√£o completa da API Disparador"
---

<Note>
  Este guia detalha todas as vari√°veis de ambiente e configura√ß√µes dispon√≠veis na API Disparador.
</Note>

## Vis√£o Geral

A API Disparador utiliza vari√°veis de ambiente para configura√ß√£o. Todas as configura√ß√µes t√™m valores padr√£o, mas √© recomendado configurar adequadamente para produ√ß√£o.

<CardGroup cols={3}>
  <Card title="Banco de Dados" icon="database" color="#2563eb">
    PostgreSQL e conex√µes
  </Card>
  <Card title="Redis" icon="server" color="#dc2626">
    Cache e filas
  </Card>
  <Card title="Aplica√ß√£o" icon="settings" color="#16a34a">
    Configura√ß√µes gerais
  </Card>
</CardGroup>

## Configura√ß√£o do Banco de Dados

### Vari√°veis PostgreSQL

<CardGroup cols={2}>
  <Card title="DB_HOST" icon="server" color="#2563eb">
    Host do PostgreSQL (padr√£o: localhost)
  </Card>
  <Card title="DB_PORT" icon="hash" color="#7c3aed">
    Porta do PostgreSQL (padr√£o: 5432)
  </Card>
  <Card title="DB_NAME" icon="database" color="#16a34a">
    Nome do banco (padr√£o: api-disparador)
  </Card>
  <Card title="DB_USER" icon="user" color="#ea580c">
    Usu√°rio do banco (padr√£o: postgres)
  </Card>
  <Card title="DB_PASSWORD" icon="key" color="#dc2626">
    Senha do banco (obrigat√≥ria)
  </Card>
  <Card title="DB_POOL_SIZE" icon="settings" color="#059669">
    Tamanho do pool (padr√£o: 10)
  </Card>
</CardGroup>

<CodeGroup>

```bash Exemplo
# Configura√ß√£o PostgreSQL
export DB_HOST=localhost
export DB_PORT=5432
export DB_NAME=api-disparador
export DB_USER=disparador
export DB_PASSWORD=your-secure-password
export DB_POOL_SIZE=20
```

</CodeGroup>

### Configura√ß√µes Hibernate

<CodeGroup>

```bash Exemplo
# Configura√ß√µes Hibernate
export HIBERNATE_DDL_AUTO=update
export SHOW_SQL=false
export FORMAT_SQL=false
export APP_TIMEZONE=America/Sao_Paulo
```

</CodeGroup>

## Configura√ß√£o do Redis

### Vari√°veis Redis

<CardGroup cols={2}>
  <Card title="REDIS_HOST" icon="server" color="#dc2626">
    Host do Redis (padr√£o: localhost)
  </Card>
  <Card title="REDIS_PORT" icon="hash" color="#2563eb">
    Porta do Redis (padr√£o: 6379)
  </Card>
  <Card title="REDIS_PASSWORD" icon="key" color="#7c3aed">
    Senha do Redis (opcional)
  </Card>
  <Card title="REDIS_TIMEOUT" icon="clock" color="#ea580c">
    Timeout de conex√£o (padr√£o: 2000ms)
  </Card>
</CardGroup>

<CodeGroup>

```bash Exemplo
# Configura√ß√£o Redis
export REDIS_HOST=localhost
export REDIS_PORT=6379
export REDIS_PASSWORD=
export REDIS_TIMEOUT=2000ms
export REDIS_MAX_ACTIVE=8
export REDIS_MAX_IDLE=8
export REDIS_MIN_IDLE=0
```

</CodeGroup>

## Configura√ß√£o da Aplica√ß√£o

### Vari√°veis Gerais

<CardGroup cols={2}>
  <Card title="APP_TIMEZONE" icon="clock" color="#16a34a">
    Fuso hor√°rio (padr√£o: America/Sao_Paulo)
  </Card>
  <Card title="PORT" icon="hash" color="#7c3aed">
    Porta da aplica√ß√£o (padr√£o: 80)
  </Card>
</CardGroup>

<CodeGroup>

```bash Exemplo
# Configura√ß√µes gerais
export APP_TIMEZONE=America/Sao_Paulo
export PORT=80
```

</CodeGroup>

### Configura√ß√µes de Campanha

<CardGroup cols={2}>
  <Card title="CAMPAIGN_MIN_SCHEDULE_MINUTES" icon="clock" color="#16a34a">
    Anteced√™ncia m√≠nima (padr√£o: 5)
  </Card>
  <Card title="CAMPAIGN_INTERVAL_MIN" icon="settings" color="#2563eb">
    Intervalo m√≠nimo (padr√£o: 3s)
  </Card>
  <Card title="CAMPAIGN_INTERVAL_MAX" icon="settings" color="#7c3aed">
    Intervalo m√°ximo (padr√£o: 30s)
  </Card>
  <Card title="CAMPAIGN_MAX_RESUME_DAYS" icon="calendar" color="#ea580c">
    Dias para retomar (padr√£o: 1)
  </Card>
</CardGroup>

<CodeGroup>

```bash Exemplo
# Configura√ß√µes de campanha
export CAMPAIGN_MIN_SCHEDULE_MINUTES=5
export CAMPAIGN_INTERVAL_MIN=3
export CAMPAIGN_INTERVAL_MAX=30
export CAMPAIGN_MAX_RESUME_DAYS=1
```

</CodeGroup>

### Configura√ß√µes de Fila

<CardGroup cols={2}>
  <Card title="QUEUE_MESSAGE_NAME" icon="list" color="#16a34a">
    Nome da fila principal (padr√£o: message_queue)
  </Card>
  <Card title="QUEUE_SCHEDULED_NAME" icon="clock" color="#2563eb">
    Nome da fila agendada (padr√£o: scheduled_queue)
  </Card>
  <Card title="QUEUE_RETRY_NAME" icon="refresh" color="#7c3aed">
    Nome da fila de retry (padr√£o: retry_queue)
  </Card>
  <Card title="QUEUE_CONCURRENCY" icon="cpu" color="#ea580c">
    Concorr√™ncia (padr√£o: 5)
  </Card>
</CardGroup>

<CodeGroup>

```bash Exemplo
# Configura√ß√µes de fila
export QUEUE_MESSAGE_NAME=message_queue
export QUEUE_SCHEDULED_NAME=scheduled_queue
export QUEUE_RETRY_NAME=retry_queue
export QUEUE_CONCURRENCY=5
export QUEUE_MAX_RETRIES=3
export QUEUE_RETRY_DELAY=60
export QUEUE_WORKER_ENABLED=true
```

</CodeGroup>

## Filas e Workers de Automa√ß√µes

As automa√ß√µes possuem sua pr√≥pria configura√ß√£o em `application.yml` para isolamento das filas e workers.

```yaml
app:
  automation:
    queue:
      message-queue: ${AUTOMATION_QUEUE_MESSAGE_NAME:automation_message_queue}
      scheduled-queue: ${AUTOMATION_QUEUE_SCHEDULED_NAME:automation_scheduled_queue}
      retry-queue: ${AUTOMATION_QUEUE_RETRY_NAME:automation_retry_queue}
      concurrency: ${AUTOMATION_QUEUE_CONCURRENCY:3}
      retry:
        attempts: ${AUTOMATION_QUEUE_MAX_RETRIES:3}
        delay: ${AUTOMATION_QUEUE_RETRY_DELAY:60}
      worker:
        enabled: ${AUTOMATION_QUEUE_WORKER_ENABLED:true}
        pool-size: ${AUTOMATION_QUEUE_WORKER_POOL_SIZE:2}
```

- `message-queue`, `scheduled-queue`, `retry-queue`: nomes das filas Redis.
- `concurrency`: concorr√™ncia desejada por execu√ß√£o do worker.
- `retry.attempts` e `retry.delay`: controle de tentativas e atraso no reprocessamento.
- `worker.enabled` e `worker.pool-size`: habilita e dimensiona o worker dedicado de automa√ß√µes.

## Flags por Empresa

A visibilidade do recurso pode ser controlada por empresa com a flag:

- `companies.automations_enabled` (padr√£o TRUE). No frontend, a flag √© refletida em `user.automationsEnabled` e controla a exibi√ß√£o do card em `/automations`.

## Configura√ß√£o do Servidor

### Vari√°veis do Tomcat

<CardGroup cols={2}>
  <Card title="SERVER_MAX_THREADS" icon="cpu" color="#16a34a">
    Threads m√°ximas (padr√£o: 200)
  </Card>
  <Card title="SERVER_MIN_THREADS" icon="cpu" color="#2563eb">
    Threads m√≠nimas (padr√£o: 10)
  </Card>
  <Card title="SERVER_CONNECTION_TIMEOUT" icon="clock" color="#7c3aed">
    Timeout de conex√£o (padr√£o: 20000ms)
  </Card>
  <Card title="SCHEDULER_POOL_SIZE" icon="settings" color="#ea580c">
    Tamanho do pool de agendamento (padr√£o: 5)
  </Card>
</CardGroup>

<CodeGroup>

```bash Exemplo
# Configura√ß√µes do servidor
export SERVER_MAX_THREADS=200
export SERVER_MIN_THREADS=10
export SERVER_CONNECTION_TIMEOUT=20000
export SCHEDULER_POOL_SIZE=5
```

</CodeGroup>

## Configura√ß√£o de Logs

### Vari√°veis de Logging

<CardGroup cols={2}>
  <Card title="LOGGING_LEVEL_COM_DISPARADOR" icon="file-text" color="#16a34a">
    N√≠vel de log da aplica√ß√£o (padr√£o: INFO)
  </Card>
  <Card title="LOG_FILE" icon="file" color="#2563eb">
    Arquivo de log (padr√£o: logs/disparador-api.log)
  </Card>
  <Card title="LOG_MAX_SIZE" icon="settings" color="#7c3aed">
    Tamanho m√°ximo do log (padr√£o: 10MB)
  </Card>
  <Card title="LOG_MAX_HISTORY" icon="calendar" color="#ea580c">
    Hist√≥rico de logs (padr√£o: 30)
  </Card>
</CardGroup>

<CodeGroup>

```bash Exemplo
# Configura√ß√µes de log
export LOGGING_LEVEL_COM_DISPARADOR=INFO
export LOGGING_LEVEL_ORG_SPRINGFRAMEWORK_SECURITY=WARN
export LOGGING_LEVEL_ORG_SPRINGFRAMEWORK_WEB=WARN
export LOGGING_LEVEL_HIBERNATE_SQL=WARN
export LOGGING_LEVEL_REDIS=WARN
export LOG_FILE=logs/disparador-api.log
export LOG_MAX_SIZE=10MB
export LOG_MAX_HISTORY=30
```

</CodeGroup>

## Configura√ß√£o de Rate Limiting

### Vari√°veis de Rate Limit

<CardGroup cols={2}>
  <Card title="RATE_LIMIT_PER_MINUTE" icon="clock" color="#16a34a">
    Limite por minuto (padr√£o: 60)
  </Card>
  <Card title="RATE_LIMIT_PER_HOUR" icon="clock" color="#2563eb">
    Limite por hora (padr√£o: 1000)
  </Card>
  <Card title="RATE_LIMIT_BURST" icon="zap" color="#7c3aed">
    Limite de burst (padr√£o: 10)
  </Card>
</CardGroup>

<CodeGroup>

```bash Exemplo
# Configura√ß√µes de rate limiting
export RATE_LIMIT_PER_MINUTE=60
export RATE_LIMIT_PER_HOUR=1000
export RATE_LIMIT_BURST=10
```

</CodeGroup>

## Configura√ß√£o do Actuator

### Vari√°veis do Actuator

<CardGroup cols={2}>
  <Card title="ACTUATOR_ENDPOINTS" icon="activity" color="#16a34a">
    Endpoints expostos (padr√£o: health,info,metrics,prometheus)
  </Card>
  <Card title="PROMETHEUS_ENABLED" icon="chart-bar" color="#2563eb">
    M√©tricas Prometheus (padr√£o: true)
  </Card>
</CardGroup>

<CodeGroup>

```bash Exemplo
# Configura√ß√µes do Actuator
export ACTUATOR_ENDPOINTS=health,info,metrics,prometheus
export PROMETHEUS_ENABLED=true
```

</CodeGroup>

## Configura√ß√£o do Swagger

### Vari√°veis do Swagger

<CardGroup cols={2}>
  <Card title="SWAGGER_ENABLED" icon="book-open" color="#16a34a">
    Habilitar Swagger (padr√£o: true)
  </Card>
  <Card title="SUPPORT_EMAIL" icon="envelope" color="#2563eb">
    Email de suporte (padr√£o: [suporte@disparador.com](mailto:suporte@disparador.com))
  </Card>
</CardGroup>

<CodeGroup>

```bash Exemplo
# Configura√ß√µes do Swagger
export SWAGGER_ENABLED=true
export SUPPORT_EMAIL=suporte@disparador.com
```

</CodeGroup>

## Configura√ß√£o Completa

### Arquivo .env Completo

<CodeGroup>

```bash .env
# ========================================
# CONFIGURA√á√ÉO COMPLETA DA API DISPARADOR
# ========================================

# ========================================
# BANCO DE DADOS
# ========================================
DB_HOST=localhost
DB_PORT=5432
DB_NAME=api-disparador
DB_USER=disparador
DB_PASSWORD=your-secure-password
DB_POOL_SIZE=20
DB_MIN_IDLE=5

# Configura√ß√µes Hibernate
HIBERNATE_DDL_AUTO=update
SHOW_SQL=false
FORMAT_SQL=false
APP_TIMEZONE=America/Sao_Paulo

# ========================================
# REDIS
# ========================================
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_TIMEOUT=2000ms
REDIS_MAX_ACTIVE=8
REDIS_MAX_IDLE=8
REDIS_MIN_IDLE=0

# ========================================
# APLICA√á√ÉO
# ========================================
APP_TIMEZONE=America/Sao_Paulo
PORT=80

# ========================================
# CAMPANHAS
# ========================================
CAMPAIGN_MIN_SCHEDULE_MINUTES=5
CAMPAIGN_INTERVAL_MIN=3
CAMPAIGN_INTERVAL_MAX=30
CAMPAIGN_MAX_RESUME_DAYS=1

# ========================================
# FILAS
# ========================================
QUEUE_MESSAGE_NAME=message_queue
QUEUE_SCHEDULED_NAME=scheduled_queue
QUEUE_RETRY_NAME=retry_queue
QUEUE_CONCURRENCY=5
QUEUE_MAX_RETRIES=3
QUEUE_RETRY_DELAY=60
QUEUE_WORKER_ENABLED=true

# ========================================
# SERVIDOR
# ========================================
SERVER_MAX_THREADS=200
SERVER_MIN_THREADS=10
SERVER_CONNECTION_TIMEOUT=20000
SCHEDULER_POOL_SIZE=5

# ========================================
# LOGS
# ========================================
LOGGING_LEVEL_COM_DISPARADOR=INFO
LOGGING_LEVEL_ORG_SPRINGFRAMEWORK_SECURITY=WARN
LOGGING_LEVEL_ORG_SPRINGFRAMEWORK_WEB=WARN
LOGGING_LEVEL_HIBERNATE_SQL=WARN
LOGGING_LEVEL_REDIS=WARN
LOG_FILE=logs/disparador-api.log
LOG_MAX_SIZE=10MB
LOG_MAX_HISTORY=30

# ========================================
# RATE LIMITING
# ========================================
RATE_LIMIT_PER_MINUTE=60
RATE_LIMIT_PER_HOUR=1000
RATE_LIMIT_BURST=10

# ========================================
# ACTUATOR
# ========================================
ACTUATOR_ENDPOINTS=health,info,metrics,prometheus
PROMETHEUS_ENABLED=true

# ========================================
# SWAGGER
# ========================================
SWAGGER_ENABLED=true
SUPPORT_EMAIL=suporte@disparador.com
```

</CodeGroup>

## Configura√ß√µes por Ambiente

### Desenvolvimento

<CodeGroup>

```bash .env.development
# Desenvolvimento - Logs detalhados
LOGGING_LEVEL_COM_DISPARADOR=DEBUG
SHOW_SQL=true
FORMAT_SQL=true
SWAGGER_ENABLED=true
ACTUATOR_ENDPOINTS=health,info,metrics,prometheus,env
```

</CodeGroup>

### Produ√ß√£o

<CodeGroup>

```bash .env.production
# Produ√ß√£o - Performance e seguran√ßa
LOGGING_LEVEL_COM_DISPARADOR=WARN
SHOW_SQL=false
FORMAT_SQL=false
SWAGGER_ENABLED=false
ACTUATOR_ENDPOINTS=health,info,metrics,prometheus
DB_POOL_SIZE=20
SERVER_MAX_THREADS=200
QUEUE_CONCURRENCY=10
```

</CodeGroup>

### Teste

<CodeGroup>

```bash .env.test
# Teste - Configura√ß√µes m√≠nimas
LOGGING_LEVEL_COM_DISPARADOR=ERROR
SHOW_SQL=false
SWAGGER_ENABLED=false
ACTUATOR_ENDPOINTS=health
DB_POOL_SIZE=5
SERVER_MAX_THREADS=50
QUEUE_CONCURRENCY=2
```

</CodeGroup>

## Valida√ß√£o de Configura√ß√£o

### Script de Valida√ß√£o

<CodeGroup>

```bash validate-config.sh
#!/bin/bash

echo "Validando configura√ß√£o da API Disparador..."

# Verificar vari√°veis obrigat√≥rias
if [ -z "$DB_PASSWORD" ]; then
    echo "‚ùå DB_PASSWORD n√£o configurado"
    exit 1
fi

# Verificar conectividade
echo "üîç Testando conex√£o com PostgreSQL..."
if pg_isready -h $DB_HOST -p $DB_PORT -U $DB_USER; then
    echo "‚úÖ PostgreSQL conectado"
else
    echo "‚ùå Erro ao conectar com PostgreSQL"
    exit 1
fi

echo "üîç Testando conex√£o com Redis..."
if redis-cli -h $REDIS_HOST -p $REDIS_PORT ping; then
    echo "‚úÖ Redis conectado"
else
    echo "‚ùå Erro ao conectar com Redis"
    exit 1
fi

echo "‚úÖ Configura√ß√£o v√°lida!"
```

</CodeGroup>

## Pr√≥ximos Passos

<CardGroup cols={3}>
  <Card title="Deployment" icon="rocket" href="/deployment">
    Fa√ßa o deploy da aplica√ß√£o
  </Card>
  <Card title="Monitoramento" icon="activity" href="/monitoring">
    Configure monitoramento
  </Card>
  <Card title="Troubleshooting" icon="wrench" href="/troubleshooting">
    Resolva problemas
  </Card>
</CardGroup>