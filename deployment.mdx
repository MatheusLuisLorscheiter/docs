---
title: "Deployment"
description: "Como fazer deploy da API Disparador"
---

<Note>
Este guia mostra como fazer deploy da API Disparador usando Docker, Docker Compose ou deployment manual.
</Note>

## Visão Geral

A API Disparador pode ser implantada de várias formas:

<CardGroup cols={3}>
  <Card title="Docker Compose" icon="docker" color="#2563eb">
    Recomendado para desenvolvimento e produção
  </Card>
  <Card title="Docker" icon="server" color="#16a34a">
    Container individual
  </Card>
  <Card title="Manual" icon="terminal" color="#7c3aed">
    Instalação direta no servidor
  </Card>
</CardGroup>

## Pré-requisitos

<CardGroup cols={2}>
  <Card title="Java 17+" icon="code" color="#16a34a">
    JDK 17 ou superior
  </Card>
  <Card title="PostgreSQL 12+" icon="database" color="#2563eb">
    Banco de dados PostgreSQL
  </Card>
  <Card title="Redis 6+" icon="server" color="#dc2626">
    Cache e filas Redis
  </Card>
  <Card title="Evolution API" icon="message-circle" color="#7c3aed">
    API do WhatsApp configurada
  </Card>
</CardGroup>

## Docker Compose (Recomendado)

### 1. Clone o Repositório

<RequestExample>

```bash
git clone https://github.com/matheusluislorscheiter/api-disparador.git
cd api-disparador
```

</RequestExample>

### 2. Configure as Variáveis de Ambiente

Crie um arquivo `.env` na raiz do projeto:

<RequestExample>

```bash
# Database
DB_HOST=localhost
DB_PORT=5432
DB_NAME=api-disparador
DB_USER=postgres
DB_PASSWORD=your-password

# Redis
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# JWT
JWT_SECRET=your-super-secret-key-change-in-production

# App Configuration
APP_TIMEZONE=America/Sao_Paulo
CAMPAIGN_MIN_SCHEDULE_MINUTES=5
CAMPAIGN_INTERVAL_MIN=3
CAMPAIGN_INTERVAL_MAX=30

# Logging
LOGGING_LEVEL_COM_DISPARADOR=INFO

# Server
PORT=8080
```

</RequestExample>

### 3. Execute com Docker Compose

<RequestExample>

```bash
# Construir e iniciar todos os serviços
docker-compose up -d

# Verificar logs
docker-compose logs -f api

# Parar serviços
docker-compose down
```

</RequestExample>

### 4. Verificar Deploy

<RequestExample>

```bash
# Health check
curl http://localhost:8080/api/actuator/health

# Swagger UI
open http://localhost:8080/api/swagger-ui.html
```

</RequestExample>

## Docker Individual

### 1. Construir a Imagem

<RequestExample>

```bash
# Construir imagem
docker build -t api-disparador:latest .

# Verificar imagem criada
docker images | grep api-disparador
```

</RequestExample>

### 2. Executar Container

<RequestExample>

```bash
# Executar com variáveis de ambiente
docker run -d \
  --name api-disparador \
  -p 8080:8080 \
  -e DB_HOST=your-db-host \
  -e DB_PASSWORD=your-password \
  -e JWT_SECRET=your-secret \
  -e REDIS_HOST=your-redis-host \
  api-disparador:latest

# Verificar logs
docker logs -f api-disparador

# Parar container
docker stop api-disparador
```

</RequestExample>

## Deployment Manual

### 1. Instalar Java 17

<RequestExample>

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install openjdk-17-jdk

# CentOS/RHEL
sudo yum install java-17-openjdk-devel

# macOS
brew install openjdk@17

# Verificar instalação
java -version
```

</RequestExample>

### 2. Configurar PostgreSQL

<RequestExample>

```bash
# Ubuntu/Debian
sudo apt install postgresql postgresql-contrib

# Criar banco de dados
sudo -u postgres psql
CREATE DATABASE "api-disparador";
CREATE USER disparador WITH PASSWORD 'your-password';
GRANT ALL PRIVILEGES ON DATABASE "api-disparador" TO disparador;
\q
```

</RequestExample>

### 3. Configurar Redis

<RequestExample>

```bash
# Ubuntu/Debian
sudo apt install redis-server

# Iniciar Redis
sudo systemctl start redis-server
sudo systemctl enable redis-server

# Verificar status
redis-cli ping
```

</RequestExample>

### 4. Baixar e Executar a Aplicação

<RequestExample>

```bash
# Baixar JAR
wget https://github.com/matheusluislorscheiter/api-disparador/releases/latest/download/api-disparador.jar

# Executar aplicação
java -jar api-disparador.jar \
  --spring.profiles.active=production \
  --DB_HOST=localhost \
  --DB_PASSWORD=your-password \
  --JWT_SECRET=your-secret
```

</RequestExample>

## Configuração de Produção

### Variáveis de Ambiente Críticas

<CardGroup cols={2}>
  <Card title="JWT_SECRET" icon="key" color="#dc2626">
    Chave secreta para tokens JWT (obrigatória)
  </Card>
  <Card title="DB_PASSWORD" icon="database" color="#2563eb">
    Senha do banco PostgreSQL (obrigatória)
  </Card>
  <Card title="REDIS_PASSWORD" icon="server" color="#7c3aed">
    Senha do Redis (se configurado)
  </Card>
  <Card title="APP_TIMEZONE" icon="clock" color="#16a34a">
    Fuso horário da aplicação
  </Card>
</CardGroup>

### Configurações de Performance

<RequestExample>

```bash
# Configurações recomendadas para produção
export DB_POOL_SIZE=20
export SERVER_MAX_THREADS=200
export QUEUE_CONCURRENCY=10
export SCHEDULER_POOL_SIZE=10
export LOGGING_LEVEL_COM_DISPARADOR=WARN
```

</RequestExample>

### Configuração de Logs

<RequestExample>

```bash
# Configurar logs para arquivo
export LOG_FILE=/var/log/api-disparador/application.log
export LOG_MAX_SIZE=100MB
export LOG_MAX_HISTORY=30

# Criar diretório de logs
sudo mkdir -p /var/log/api-disparador
sudo chown $USER:$USER /var/log/api-disparador
```

</RequestExample>

## Monitoramento

### Health Checks

<RequestExample>

```bash
# Script de health check
#!/bin/bash
HEALTH_URL="http://localhost:8080/api/actuator/health"
RESPONSE=$(curl -s -o /dev/null -w "%{http_code}" $HEALTH_URL)

if [ $RESPONSE -eq 200 ]; then
    echo "API está funcionando"
    exit 0
else
    echo "API está com problema"
    exit 1
fi
```

</RequestExample>

### Métricas com Prometheus

<RequestExample>

```yaml
# prometheus.yml
scrape_configs:
  - job_name: 'api-disparador'
    static_configs:
      - targets: ['localhost:8080']
    metrics_path: '/api/actuator/prometheus'
    scrape_interval: 30s
```

</RequestExample>

## Troubleshooting

### Problemas Comuns

<CardGroup cols={2}>
  <Card title="Porta 8080 em uso" icon="alert-triangle" color="#dc2626">
    `lsof -i :8080` e `kill -9 <PID>`
  </Card>
  <Card title="Banco não conecta" icon="database" color="#2563eb">
    Verificar credenciais e firewall
  </Card>
  <Card title="Redis não conecta" icon="server" color="#7c3aed">
    `redis-cli ping` e verificar porta 6379
  </Card>
  <Card title="Memória insuficiente" icon="cpu" color="#ea580c">
    Aumentar heap: `-Xmx2g -Xms1g`
  </Card>
</CardGroup>

### Logs Importantes

<RequestExample>

```bash
# Ver logs da aplicação
tail -f /var/log/api-disparador/application.log

# Ver logs do Docker
docker logs -f api-disparador

# Ver logs do sistema
journalctl -u api-disparador -f
```

</RequestExample>

## Segurança

### Configurações de Segurança

<CardGroup cols={2}>
  <Card title="HTTPS" icon="lock" color="#16a34a">
    Configure SSL/TLS em produção
  </Card>
  <Card title="Firewall" icon="shield" color="#2563eb">
    Abra apenas porta 8080
  </Card>
  <Card title="JWT Secret" icon="key" color="#dc2626">
    Use secret forte e único
  </Card>
  <Card title="Database" icon="database" color="#7c3aed">
    Configure usuário específico
  </Card>
</CardGroup>

### Exemplo de Nginx

<RequestExample>

```nginx
# /etc/nginx/sites-available/api-disparador
server {
    listen 80;
    server_name api.disparador.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl;
    server_name api.disparador.com;
    
    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;
    
    location / {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}
```

</RequestExample>

## Backup e Recuperação

### Backup do Banco

<RequestExample>

```bash
# Backup completo
pg_dump -h localhost -U disparador api-disparador > backup_$(date +%Y%m%d).sql

# Backup automático (cron)
0 2 * * * pg_dump -h localhost -U disparador api-disparador > /backups/api-disparador_$(date +\%Y\%m\%d).sql
```

</RequestExample>

### Backup do Redis

<RequestExample>

```bash
# Backup Redis
redis-cli BGSAVE

# Copiar arquivo de dump
cp /var/lib/redis/dump.rdb /backups/redis_$(date +%Y%m%d).rdb
```

</RequestExample>

## Próximos Passos

<CardGroup cols={3}>
  <Card title="Configuração" icon="settings" href="/configuration">
    Configure variáveis de ambiente
  </Card>
  <Card title="Monitoramento" icon="activity" href="/monitoring">
    Configure monitoramento
  </Card>
  <Card title="Troubleshooting" icon="wrench" href="/troubleshooting">
    Resolva problemas
  </Card>
</CardGroup> 